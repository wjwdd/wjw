<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/mui.min.css">
	</head>
	<style type="text/css">
		/* 整体设置 */
		
		* {
			margin: 0px;
			padding: 0px;
		}
		/**
 * 设置日历的大小
 */
		
		.calendar {
			width: 90%;
			display: block;
			margin: 0 5%;
			padding: 0 10px;
			background: #fff;
			box-shadow: -2px 3px 1px #ccc;
			border-radius: 5px;
		}
		
		#jf {
			width: 90%;
			display: block;
			margin: 0 5% 15%;
			padding: 10px;
			background: #fff;
			box-shadow: -2px 3px 1px #ccc;
			border-radius: 5px;
		}
		
		#jf li {
			padding: 10px 0px;
			list-style: none;
			border-bottom: 1px solid #ccc;
			overflow: hidden;
		}
		
		.lq {
			width: 60px;
			text-align: center;
			display: block;
			float: right;
			margin-top: -6px;
			background: #5da8fc;
			color: #fff;
			border: 0px;
			text-align: center;
			padding: 5px 0;
		}
		/**
 * 设置日历顶部盒子
 */
		
		.calendar .calendar-title-box {
			position: relative;
			width: 100%;
			height: 36px;
			line-height: 36px;
			text-align: center;
			display: inline-block;
		}
		/**
 * 设置上个月的按钮图标
 */
		
		.calendar .prev-month {
			position: absolute;
			top: 12px;
			left: 0px;
			display: inline-block;
			width: 0px;
			height: 0px;
			border-left: 0px;
			border-top: 6px solid transparent;
			border-right: 8px solid #5da8fc;
			border-bottom: 6px solid transparent;
		}
		/**
 * 设置下个月的按钮图标
 */
		
		.calendar .next-month {
			position: absolute;
			top: 12px;
			right: 0px;
			display: inline-block;
			width: 0px;
			height: 0px;
			border-right: 0px;
			border-top: 6px solid transparent;
			border-left: 8px solid #5da8fc;
			border-bottom: 6px solid transparent;
			cursor: pointer;
		}
		/* 设置日历表格样式 */
		
		.calendar-table {
			width: 100%;
			border-collapse: collapse;
			text-align: center;
		}
		
		#calendarTitle {
			color: #5da8fc;
			font-size: 18px;
			font-weight: bold;
		}
		/* 表格行高 */
		
		.calendar-table tr {
			height: 30px;
			line-height: 20px;
		}
		
		.calendar-table th {
			display: inline-block;
			width: 23px;
			height: 23px;
			margin: 0 10px;
		}
		
		.calendar-table tr td {
			display: inline-block;
			width: 23px;
			height: 23px;
			margin: 0 10px;
		}
		/* 当前天 颜色特殊显示 */
		/*.currentDay {
			color: red;
		}*/
		
		.currentDay {
			background: #5da8fc;
			border-radius: 50%;
			line-height: 23px;
			color: #fff;
		}
		/* 本月 文字颜色 */
		
		.currentMonth {
			color: #999;
		}
		/* 其他月颜色 */
		
		.otherMonth {
			color: #ede;
		}
		
		#popover {
			min-width: 282px;
			height: 300px;
			top: 50% !important;
			margin-top: -150px;
			left: 50% !important;
			margin-left: -141px;
		}
		
		@media (min-width: 400px) {
			#popover {
				width: 80%;
				margin-left: -40%;
			}
		}
		
		.mui-popover .mui-popover-arrow {
			display: none !important;
		}
	</style>

	<body style="background:#f5f4f4;">
		<header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#000"></a>
			<h1 class="mui-title">签到</h1>
		</header>
		<div class="mui-scroll-wrapper">
			<div class="mui-scroll cjs">
				<img style="width:100%;margin-top:44px;" src="../../images/everyqd.png" alt="" />
				<p style="margin:5% 5% 1% 5%;font-size: 18px;color:#4d5155;">本月签到记录：连续签到<span style="color:#ef733c;">2</span>天</p>
				<p class='calendar' id='calendar' style=""></p>
				<p style="margin:5% 5% 1% 5%;font-size: 18px;color:#4d5155;">完成任务领积分：总积分<span class="zjf" style="color:#ef733c;">10</span></p>
				<ul id="jf">
					<li><span style="display:block;float:left;color:#696c70;">每日登录<span style="color:#ef733c;">&nbsp+&nbsp10&nbsp</span>积分</span><button class="lq">领取</button></li>
					<li><span style="display:block;float:left;color:#696c70;">每日签到<span style="color:#ef733c">&nbsp+&nbsp20&nbsp</span>积分</span><button class="lq">领取</button></li>
					<li><span style="display:block;float:left;color:#696c70;">每日发帖<span style="color:#ef733c">&nbsp+&nbsp20&nbsp</span>积分</span><button class="lq">领取</button></li>
					<li><span style="display:block;float:left;color:#696c70;">每日分享<span style="color:#ef733c">&nbsp+&nbsp30&nbsp</span>积分</span><button class="lq">领取</button></li>
					<li style="border: 0px;"><span style="display:block;float:left;color:#696c70;">推荐好友<span style="color:#ef733c">&nbsp+&nbsp50&nbsp</span>积分</span><button class="lq">领取</button></li>
				</ul>
			</div>
		</div>
		<div id="popover" class="mui-popover">
			<div class="mui-popover-arrow"></div>
			<div class="mui-content-padded ">
				<h4 style="color:#5DA8FC;text-align:center;padding:10px;">请选择职业</h4>
				<div class="fxzw"></div>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script type='text/javascript'>
			(function() {
				/*
				 * 用于记录日期，显示的时候，根据dateObj中的日期的年月显示
				 */
				var deceleration = mui.os.ios ? 0.003 : 0.0009;
				mui('.mui-scroll-wrapper').scroll({
					bounce: true,
					indicators: true, //是否显示滚动条
					deceleration: deceleration,
					scrollX: true, //是否横向滚动
				});
				var dateObj = (function() {
					var _date = new Date(); // 默认为当前系统时间
					return {
						getDate: function() {
							return _date;
						},
						setDate: function(date) {
							_date = date;
						}
					};
				})();

				// 设置calendar p中的html部分
				renderHtml();
				// 表格中显示日期
				showCalendarData();
				// 绑定事件
				bindEvent();

				/**
				 * 渲染html结构
				 */
				function renderHtml() {
					var calendar = document.getElementById("calendar");
					var titleBox = document.createElement("p"); // 标题盒子 设置上一月 下一月 标题
					var bodyBox = document.createElement("p"); // 表格区 显示数据

					// 设置标题盒子中的html
					titleBox.className = 'calendar-title-box';
					titleBox.innerHTML = "<span class='prev-month' id='prevMonth'></span>" +
						"<span class='calendar-title' id='calendarTitle'></span>" +
						"<span id='nextMonth' class='next-month'></span>";
					calendar.appendChild(titleBox); // 添加到calendar p中

					// 设置表格区的html结构
					bodyBox.className = 'calendar-body-box';
					var _headHtml = "<tr>" +
						"<th>日</th>" +
						"<th>一</th>" +
						"<th>二</th>" +
						"<th>三</th>" +
						"<th>四</th>" +
						"<th>五</th>" +
						"<th>六</th>" +
						"</tr>";
					var _bodyHtml = "";

					// 一个月最多31天，所以一个月最多占6行表格
					for(var i = 0; i < 6; i++) {
						_bodyHtml += "<tr>" +
							"<td></td>" +
							"<td></td>" +
							"<td></td>" +
							"<td></td>" +
							"<td></td>" +
							"<td></td>" +
							"<td></td>" +
							"</tr>";
					}
					bodyBox.innerHTML = "<table id='calendarTable' class='calendar-table'>" +
						_headHtml + _bodyHtml +
						"</table>";
					// 添加到calendar p中
					calendar.appendChild(bodyBox);
				}

				/**
				 * 表格中显示数据，并设置类名
				 */
				function showCalendarData() {
					var _year = dateObj.getDate().getFullYear();
					var _month = dateObj.getDate().getMonth() + 1;
					var _dateStr = getDateStr(dateObj.getDate());

					// 设置顶部标题栏中的 年、月信息
					var calendarTitle = document.getElementById("calendarTitle");
					var titleStr = _dateStr.substr(0, 4) + "年" + _dateStr.substr(4, 2) + "月";
					calendarTitle.innerText = titleStr;

					// 设置表格中的日期数据
					var _table = document.getElementById("calendarTable");
					var _tds = _table.getElementsByTagName("td");
					var _table = document.getElementById("calendarTable");
					var _tds = _table.getElementsByTagName("td");
					var btn = document.querySelector('#btn');
					//	qd
					var lq = document.getElementsByClassName('lq');
					var zjf = document.querySelector('.zjf');
					var nowarr = [];
					mui.ajax($$$.siturl + 'm=App&c=PersonPoint', {
						type: 'get',
						dataType: 'json',
						success: function(data) {
							console.log(JSON.stringify(data));
							zjf.innerHTML = data.data.data.points;
							var data = data.data;
							xrdate(data);
							if(data.issigngipoind == 1) {
								lq[0].style.background = '#c4c4c4';
								lq[0].innerHTML = '已领取';
							}
							if(data.islogipoind == 1) {
								lq[1].style.background = '#c4c4c4';
								lq[1].innerHTML = '已领取';
							}
							if(data.isptop == 1) {
								lq[2].style.background = '#c4c4c4';
								lq[2].innerHTML = '已领取';
							}
							if(data.isshare == 1) {
								lq[3].style.background = '#c4c4c4';
								lq[3].innerHTML = '已领取';
							}
						}
					})

					//渲染日期
					function xrdate(data) {
						for(var i = 0; i < data.tisklog.length; i++) {
							nowarr.push(data.tisklog[i].date);
						}
						//							console.log(qdarr);
						var _firstDay = new Date(_year, _month - 1, 1); // 当前月第一天
						for(var i = 0; i < _tds.length; i++) {
							var _thisDay = new Date(_year, _month - 1, i + 1 - _firstDay.getDay());
							var _thisDayStr = getDateStr(_thisDay);

							_tds[i].innerText = _thisDay.getDate();
							//_tds[i].data = _thisDayStr;
							_tds[i].setAttribute('data', _thisDayStr);
							_tds[i].setAttribute('qd', false);
							var _thisqd = _tds[i].getAttribute('qd');
							if(_thisDayStr.substr(0, 6) == getDateStr(_firstDay).substr(0, 6)) {
								_tds[i].className = 'currentMonth'; // 当前月
							} else { // 其他月
								_tds[i].className = 'otherMonth';
							}
							for(var j = 0; j < nowarr.length; j++) {
								//							console.log(nowarr[j]);
								//								console.log(qdarr[j]);
								//							console.log(_tds[i].getAttribute('data'))
								if(nowarr[j] == _tds[i].getAttribute('data') && _thisDayStr.substr(0, 6) == getDateStr(_firstDay).substr(0, 6)) {

									_tds[i].className = 'currentDay';
								}
							}
						}
					}
				}

				/**
				 * 绑定上个月下个月事件
				 */
				function bindEvent() {
					var prevMonth = document.getElementById("prevMonth");
					var nextMonth = document.getElementById("nextMonth");
					addEvent(prevMonth, 'click', toPrevMonth);
					addEvent(nextMonth, 'click', toNextMonth);
				}

				/**
				 * 绑定事件
				 */
				function addEvent(dom, eType, func) {
					if(dom.addEventListener) { // DOM 2.0
						dom.addEventListener(eType, function(e) {
							func(e);
						});
					} else if(dom.attachEvent) { // IE5+
						dom.attachEvent('on' + eType, function(e) {
							func(e);
						});
					} else { // DOM 0
						dom['on' + eType] = function(e) {
							func(e);
						}
					}
				}

				/**
				 * 点击上个月图标触发
				 */
				function toPrevMonth() {
					var date = dateObj.getDate();
					dateObj.setDate(new Date(date.getFullYear(), date.getMonth() - 1, 1));
					showCalendarData();
				}

				/**
				 * 点击下个月图标触发
				 */
				function toNextMonth() {
					var date = dateObj.getDate();
					dateObj.setDate(new Date(date.getFullYear(), date.getMonth() + 1, 1));
					showCalendarData();
				}

				/**
				 * 日期转化为字符串， 4位年+2位月+2位日
				 */
				function getDateStr(date) {
					var _year = date.getFullYear();
					var _month = date.getMonth() + 1; // 月从0开始计数
					var _d = date.getDate();

					_month = (_month > 9) ? ("" + _month) : ("0" + _month);
					_d = (_d > 9) ? ("" + _d) : ("0" + _d);
					return _year + _month + _d;
				}
				var table = document.getElementById("calendarTable");
				var tds = table.getElementsByTagName('td');
				for(var i = 0; i < tds.length; i++) {
					addEvent(tds[i], 'click', function(e) {
						//						console.log(e.target.getAttribute('data'));
					});
				}
				//提示签到成功；
				//				mui.ajax($$$.siturl + 'm=app&c=PersonPoint&a=siginto', {
				//					type: 'get',
				//					dataType: 'json',
				//					success: function(data) {
				//						console.log(JSON.stringify(data));
				//						if(data.staus == 0) {
				//							mui.alert(data.data);
				//						} else if(data.staus == 1) {
				//							mui.alert(data.msg);
				//						}
				//
				//					}
				//				})
				var lq = document.getElementsByClassName('lq');
				//每日登录
				lq[0].onclick = function() {
					mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=logpoint', {
						type: 'get',
						dataType: 'json',
						success: function(data) {
							console.log(JSON.stringify(data));
							if(data.staus == 1) {
								lq[0].style.background = '#c4c4c4';
								lq[0].innerHTML = '已领取';
								mui.alert(data.msg);
							} else if(data.staus == 2) {
								mui.alert(data.msg);

							} else if(data.staus == 3) {

								mui.alert(data.msg);

							}

						}
					})
				}
				//每日签到
				lq[1].onclick = function() {
					mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=logpoint', {
						type: 'get',
						dataType: 'json',
						success: function(data) {
							console.log(JSON.stringify(data));
							if(data.staus == 1) {
								lq[1].style.background = '#c4c4c4';
								lq[1].innerHTML = '已领取';

							} else if(data.staus == 2) {
								mui.alert(data.msg);

							} else if(data.staus == 3) {

								mui.alert(data.msg);

							}

						}
					})
				}
				//每日发帖
				lq[2].onclick = function() {
					mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=ComTopPoint', {
						type: 'get',
						dataType: 'json',
						success: function(data) {
							console.log(JSON.stringify(data));
							if(data.staus == 1) {
								lq[2].style.background = '#c4c4c4';
								lq[2].innerHTML = '已领取';
								mui.alert(data.msg);
							} else if(data.staus == 2) {
								mui.alert(data.msg);

							} else if(data.staus == 3) {

								mui.alert(data.msg);

							}

						}
					})
				}
				//每日分享
				var fenxiangurl, fengxianglog, fengxiangtext, fengxiangtop;
				var fxzw = document.querySelector('.fxzw');
				lq[3].onclick = function() {
					mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=RandomJob', {
						type: 'get',
						dataType: 'json',
						success: function(data) {
							console.log(JSON.stringify(data));
							fxzw.innerHTML = '';
							for(var i = 0; i < data.data.length; i++) {

								var div = document.createElement('div');
								div.innerHTML += '<div id="xxx" style="font-size:14px;width:100%;height:50px;line-height:50px;">' + data.data[i].jobs_name + '<button class="mui-btn mui-btn-positive mui-btn-outlined mui-pull-right share" data-id="' + data.data[i].jid + '" style="margin:10px 10px 0 0; border: 0;background:#5DA8FC;color:#fff;border-radius:10px;">分享</button></div>';
								fxzw.appendChild(div);

							}

						}
					})
					setTimeout(function() {
						mui("#popover").popover("toggle");
					}, 300)

					//					mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=SharePoint', {
					//						type: 'get',
					//						dataType: 'json',
					//						success: function(data) {
					//							console.log(JSON.stringify(data));
					//							if(data.staus == 1) {
					//								lq[3].style.background = '#c4c4c4';
					//								lq[3].innerHTML = '已领取';
					//								mui.alert(data.msg);
					//							} else if(data.staus == 2) {
					//								mui.alert(data.msg);
					//
					//							} else if(data.staus == 3) {
					//
					//								mui.alert(data.msg);
					//
					//							}
					//
					//						}
					//					})
				}
				//分享
				if(window.plus) {
					onPlusReady();
				} else {
					document.addEventListener('plusready', onPlusReady, false);
				}
				//							var yusr = document.querySelector("#share");
				//							console.log(yusr.outerHTML);

				function onPlusReady() {

					//								yusr.addEventListener("tap", shareHref, false);
					mui(document.body).on('tap', '.share', shareHref);
					updateSerivces();

					//		            document.getElementById('weixin').addEventListener('tap',function() {
					//			            console.log("微信"); 
					//			            authLogin('weixin'); 
					//			        }) 

					if(plus.os.name == "Android") {
						Intent = plus.android.importClass("android.content.Intent");
						File = plus.android.importClass("java.io.File");
						Uri = plus.android.importClass("android.net.Uri");
						main = plus.android.runtimeMainActivity();
					}

					/**分享按钮*/
					function shareHref() {
						console.log(this.getAttribute('data-id'));
						var jid = this.getAttribute('data-id');
						localStorage.setItem('jid', jid);
						mui.ajax($$$.siturl + "m=App&c=index&a=compangprofil&jid=" + jid, {
							type: 'get',
							dataType: 'json',
							success: function(data) {
								console.log(JSON.stringify(data));
								fengxiangtop = "直招帮";
								fengxianglog = $$$.imgurl + 'data/weixin/1.png';
								fengxiangtext = "【直招帮】 " + data.data.jobs_name + "正在招" + data.data.category_cn +
									"综合工资" +
									data.data.minwage +
									"--" +
									data.data.maxwage +
									" 就等你来报名";
								//console.log(fengxiangtext);
								fengxiangtop = fengxiangtext;

							}
						})

						var ids = [{
								id: "weixin",
								ex: "WXSceneSession" /*微信好友*/
							}, {
								id: "weixin",
								ex: "WXSceneTimeline" /*微信朋友圈*/
							}],
							bts = [{
								title: "发送给微信好友"
							}, {
								title: "分享到微信朋友圈"
							}];
						plus.nativeUI.actionSheet({
								cancel: "取消",
								buttons: bts
							},
							function(e) {

								var i = e.index;
								if(i > 0) {
									shareAction(ids[i - 1].id, ids[i - 1].ex);
								}
							}
						);
					}

					/** 
					 * 分享操作 
					 */
					function shareAction(id, ex) {
						var s = null;
						console.log(id, ex);
						if(!id || !(s = shares[id])) {
							outLine("无效的分享服务！");
							return;
						}
						console.log(s.authenticated);
						if(s.authenticated) {
							outSet("---已授权---");
							shareMessage(s, ex);
						} else {
							outSet("---未授权---");
							s.authorize(function() {
								shareMessage(s, ex);
							}, function(e) {
								outLine("认证授权失败");
							});
						}
					}

					/** 
					 * 发送分享消息 
					 */
					function shareMessage(s, ex) {

						var jidjob = localStorage.getItem('jid');
						console.log(ex);
						console.log(JSON.stringify(s));
						var msg = {

							href: 'http://www.zhizhaojob.cn/index.php?m=Mobile&c=jobs&a=show&id=' + jidjob,
							title: fengxiangtop,
							content: fengxiangtext,
							thumbs: [fengxianglog],
							pictures: [fengxianglog],
							extra: {
								scene: ex
							}
						};
						s.send(msg, function() {

							//提交
							mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=SharePoint', {
								type: 'get',
								dataType: 'json',
								success: function(data) {
									outLine("分享成功!");
								}
							})

						}, function(e) {
							outLine("分享失败!");
						});
					}

					/** 
					 * 更新分享服务 
					 */
					function updateSerivces() {
						plus.share.getServices(function(s) {
							shares = {};
							for(var i in s) {
								var t = s[i];
								shares[t.id] = t;
							}
							outSet("获取分享服务列表成功");
						}, function(e) {
							outSet("获取分享服务列表失败：" + e.message);
						});
					}

					// 控制台输出日志 
					function outSet(msg) {
						//				            console.log(msg); 
					}
					// 界面弹出吐司提示 
					function outLine(msg) {
						mui.toast(msg);
					}

					// 登录操作 
					function authLogin(type) {
						var s;
						for(var i = 0; i < auths.length; i++) {
							if(auths[i].id == type) {
								s = auths[i];
								break;
							}
						}
						if(!s.authResult) {
							s.login(function(e) {
								mui.toast("登录认证成功！");
								authUserInfo(type);
							}, function(e) {
								mui.toast("登录认证失败！");
							});
						} else {
							mui.toast("已经登录认证！");
						}
					}

					// 微信登录认证信息 
					function authUserInfo(type) {
						var s;
						for(var i = 0; i < auths.length; i++) {
							if(auths[i].id == type) {
								s = auths[i];
								break;
							}
						}
						if(!s.authResult) {
							mui.toast("未授权登录！");
						} else {
							s.getUserInfo(function(e) {
								var josnStr = JSON.stringify(s.userInfo);
								var jsonObj = s.userInfo;
								console.log("获取用户信息成功：" + josnStr);
								showData(type, jsonObj);
								authLogout();
							}, function(e) {
								alert("获取用户信息失败：" + e.message + " - " + e.code);
							});
						}
					}

					function showData(type, data) {
						switch(type) {
							case 'weixin':
								headImage.src = data.headimgurl;
								break;
							case 'qq':
								headImage.src = data.figureurl_qq_2;
								break;
							case 'sinaweibo':
								headImage.src = data.avatar_large;
								break;
							default:
								break;
						}
					}
				}
			})();

			//每日登录
			//			mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=logpoint', {
			//				type: 'get',
			//				dataType: 'json',
			//				success: function(data) {
			//					console.log(JSON.stringify(data));
			//					//						mui.alert(data.data);
			//					if(data.staus == '1') {
			//						lq[0].onclick = function() {
			//
			//						}
			//					} else if(data.staus == 3) {
			//						lq[1].style.background = '#c4c4c4';
			//						lq[1].innerHTML = '已领取';
			//
			//					}
			//
			//				}
			//			})
		</script>
	</body>

</html>