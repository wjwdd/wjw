mui.init({

});
//			var isimg=localStorage.getItem("tximg");
//在选择或者拍摄完成后跳出裁剪页面并把图片路径传递到此页面
mui.plusReady(function() {
	//				localStorage.clear();
	var image = document.getElementById('image');
	var cropper = null;
	var resImg = null;

	image.src = localStorage.getItem('tximg');
	//				console.log(image.src);

	initCropper();
	document.getElementById("save").addEventListener("tap", getImg);
	document.getElementById("redo").addEventListener("tap", function() {
		cropper.rotate(90);
	});
	document.getElementById("undo").addEventListener("tap", function() {
		cropper.rotate(-90);
	});

	function initCropper() {
		cropper = new Cropper(image, {
			aspectRatio: 1 / 1,
			dragMode: 'move',
			rotatable: true,
			minCropBoxWidth: 200,
			minCropBoxHeight: 200,
			minCanvasWidth: 200,
			minCanvasHeight: 200,
			minContainerWidth: 200,
			minContainerHeight: 200,
			crop: function(data) {}
		});
	}

	function getImg() {
		resImg = cropper.getCroppedCanvas({
			width: 200,
			height: 200
		}).toDataURL("image/png", 1 || 0.8);
		//				console.log(resImg);
		uploadHead(resImg);

	}

	function uploadHead(imgPath) {
		// console.log("imgPath = " + imgPath); 
		var getbase = imgPath.replace("data:image/png;base64,", "");
		var imgData = getbase;
		console.log(getbase);
		/*在这里调用上传接口*/
		mui.ajax($$$.siturl + 'm=App&c=InfoMeber&a=adavarse', {
			data: {
				files: imgData
			},
			dataType: 'json',
			type: 'post',
			timeout: 10000,
			//contentType:2,
			success: function(data) {
				if(data.staus == 1) {
					var list2 = plus.webview.getWebviewById('bianji.html');
					mui.fire(list2, 'backbj');
					var list = plus.webview.getWebviewById('wode.html');
					mui.fire(list, 'ymrefresh');
					mui.back();
				}

				if(data.staus == 0) {

				}

			},
			error: function(xhr, type, errorThrown) {

			}

		});

	}

})