<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>我的发布</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="../../css/mui.min.css">
		<!--App自定义的css-->
		<!--<link rel="stylesheet" type="text/css" href="../css/app.css" />-->
		<style>
			html,
			body {
				height: 100%;
			}
			
			<style type="text/css">
			/*头部区域*/
			
			.mui-bar {
				background-color: #5CA8FC;
			}
			
			.mui-bar .mui-icon:active {
				opacity: 1;
			}
			/*内容区域*/
			
			.mui-card {
				margin: 0;
				margin-bottom: 10px;
			}
			
			.mui-card-footer:before,
			.mui-card-header:after {
				background-color: #fff;
			}
			
			.mui-card-footer:before {
				position: static;
			}
			/*图片*/
			
			.smallul {
				padding: 0;
				/*background-color: #ccc;*/
				width: 100%;
				box-sizing: border-box;
			}
			
			.smallul::after,
			.smallul::before {
				content: ' ';
				height: 0;
				visibility: hidden;
				display: block;
				clear: both;
			}
			
			.smallul li {
				list-style: none;
				float: left;
				width: 32%;
				margin-right: 1%;
				margin-bottom: 10px;
				height: 110px;
				background-color: #fff;
				border: 1px solid #ededed;
			}
			
			@media screen and (min-width: 768px) {
				.smallul li {
					width: 13%;
					margin-right: 1%;
				}
			}
			
			#footer {
				position: fixed;
				top: 44px;
				background-color: #fff;
			}
			
			.cheng {
				width: 100%;
				height: 88px;
			}
			
			.mui-control-content {
				position: relative;
				display: block;
			}
			
			.block {
				float: left;
				list-style: none;
				width: 50%;
			}
			
			#content {
				width: 200%;
				padding-left: 0;
				background-color: #fff;
				margin-top: 5px;
			}
			
			#sliderSegmentedControl {
				//margin-top: 45px;
			}
		</style>

		</style>

	</head>

	<body>

		<style>
			.mui-control-content {
				background-color: white;
				min-height: 215px;
			}
			
			.mui-control-content .mui-loading {
				margin-top: 50px;
			}
			/*#item1mobile {
				overflow：scroll;
			}*/
			
			.mui-table-view-cell {
				/*background: red;*/
			}
			
			#bigtabar {
				height: 100%;
				overflow: auto;
				/*background-color: red;*/
				/*overflow：hidden;*/
			}
			
			.rome {
				//background-color: red;
			}
			
			.fl {
				float: left;
			}
			
			.fr {
				float: right;
			}
			
			.clear {
				clear: both;
			}
			.top{
				padding-top: 55px;
				padding-bottom: 15px;
				position: relative;
			}
			.fabu{
				width: 50%;
				text-align: center;
				color: deepskyblue;
			}
			.canyu{
				width: 50%;
				text-align: center;
			}
			.think{
				height: 2px;
				width: 50%;
				background-color: deepskyblue;
				position: absolute;
				top: 89px;
				left: 0;
				/*display: none;*/
			
			}
			.think2 {
				height: 2px;
				width: 50%;
				background-color: deepskyblue;
				position: absolute;
				top: 89px;
				right: 0;
				display: none;
			}
			.tiaozhuan {
				position: fixed;
				top: 9px;
				left: 13px;
				z-index: 20;
				/*background-color: red;*/
			}
		</style>
		<header class="mui-bar mui-bar-nav" style="background-color: #5CA8FC;">
			<!--<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #fff;"></a>-->
			<h1 class="mui-title" style="color: #fff;">我的发布</h1>
		</header>
			<a class="tiaozhuan mui-icon mui-icon-left-nav mui-pull-left"style="color: #fff;" href="../../wode.html"></a>
		<div class="top">
			<div class="fabu fl">
				我的发布
			</div>
			<div class="canyu fl">
				我参与的
			</div>
			<div class="clear">
				
			</div>
			<div class="think fl">
				
			</div>
			<div class="think2 fl">
				
			</div>
			<div class="clear">
				
			</div>
		</div>
		<!--头部区域-->
		<!--<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
			<a class="mui-control-item fabu" href="#item1mobile">
				我发布的
			</a>
			<a class="mui-control-item" href="#item2mobile">
				我参与的
			</a>
			<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-6"></div>
		</div>-->
		<!--蓝色滚动进度条-->
		<div>
			<!--内容区域-->
			<!--数据列表-->
			<!--职位详细列表-->
			<ul class="mui-table-view  refreshContainer" id="bigtabar">

			</ul>
			<!--<ul class="mui-table-view" id="bigtabar_list2" style="z-index: 2;">-->

		</div>
		<!--</div>-->
		<script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>

		<script src="../../js/mui.min.js"></script>

		<script>
			var canyu = document.querySelector(".canyu")
			canyu.onclick=function () {
				
//				mui.openWindow({
//					url: 'aboutmy.html',
//					id: 'aboutmy',
//					extras: {
//						
//					},
//					createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
//					waiting: {
//						autoShow: true, //自动显示等待框，默认为true
//						title: '正在加载...', //等待对话框上显示的提示内容
//					}
//				})
				window.location.href="aboutmy.html"
			}
			var page = 1;
			mui.init({
				pullRefresh: {
					container: '.refreshContainer', //待刷新区域标识，querySelector能定位的css选择器均可，比如：id、.class等
					up: {
						height: 50, //可选.默认50.触发上拉加载拖动距离
						auto: true, //可选,默认false.自动上拉加载一次
						contentrefresh: "正在加载...", //可选，正在加载状态时，上拉加载控件上显示的标题内容
						contentnomore: '没有更多数据了', //可选，请求完毕若没有更多数据时显示的提醒内容；
						//callback: pullfresh_function //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
					}
				},
			});

			function pullfresh_function() {
				
				//page++;
				//sssrequest(page);
				//this.endPullupToRefresh(false)
			}

			var page = 1;
			// 上拉加载
			function pullfresh_function1() {
				//业务逻辑代码，比如通过ajax从服务器获取新数据；
				//注意：
				//1、加载完新数据后，必须执行如下代码，true表示没有更多数据了：
				//2、若为ajax请求，则需将如下代码放置在处理完ajax响应数据之后
				page++;
				request();
				this.endPullupToRefresh(false);

				function request() {
					mui.ajax($$$.siturl + 'm=App&c=Mydis&a=MyTopic&page=' + page, {
						type: 'GET',
						dataType: 'json',
						success: function(data) {

							new CreatList({
								id: 'bigtabar_list2',
								evclass: 'tourl',
								data: data,
							})

						},
						error: function(e) {
							mui.alert(e.message);
						}
					});

				}
			}
			// 跳转到帖子详情页
			function gocomdetal(e) {
				var div = e;
				var dataid = div.getAttribute('data-id');
				localStorage.setItem('t_id', dataid);
				mui.openWindow({
					url: 'community_detail.html',
					id: 'community_detail',
					extras: {
						tid: dataid
					},
					createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
					waiting: {
						autoShow: true, //自动显示等待框，默认为true
						title: '正在加载...', //等待对话框上显示的提示内容
					}
				})
			}
			// 删除选中的帖子
			function goDel(obj, e) {
				var ulbox = document.querySelector('#bigtabar');
				var fli = obj.parentNode.parentNode.parentNode.parentNode;
				var box = fli.parentNode;
				var t_id = fli.getAttribute('data-id');
				e.stopPropagation();
				mui.ajax($$$.siturl + 'm=App&c=Mydis&a=deleMytop', {
					type: 'get',
					data: {
						't_id': t_id
					},
					dataType: 'json',
					success: function(data) {
						box.removeChild(fli);
					},
					error: function(xhr, err) {
//						mui.alert(xhr, err);
					}
				});
			}

			/*
			 * 页面加载之后显示
			 * yp
			 */
			var keshi = document.getElementById('slider');
			var ul = document.getElementById('bigtabar');
			window.onload = function() {
				//我发发布的
				mui.ajax($$$.siturl + 'm=App&c=Mydis&a=MyTopic&page=1', {
					type: 'get',
					data: {},
					dataType: 'json',
					success: function(data) {
						//mui.alert(JSON.stringify(data));
						new CreatList({
							id: "bigtabar",
							evclass: 'tourl',
							data: data.data,
						})
					},
					error: function(xht, err) {
						mui.alert(xht);
					}
				});

			}
		</script>
		<!--
	作者：1311875357@qq.com
	时间：2017-04-22
	描述：方法函数区
-->
		<script>
			// 函数定义、我发布的数据列表
			function CreatList(option) {
				this.id = option.id || 'work_detail';
				this.bg = option.bg || '#fff';
				this.data = option.data;
				this.evclass = option.evclass;
				this.init();

			}
			CreatList.prototype = {
				init: function() {
					this.insert();
				},
				getData: function() {
					var datali = this.data;
					var ary = new Array();
					return datali;
				},
				creat: function() {
					var res = "";
					(function($) {
						for(var i = 0; i < $.length; i++) {

							var img = $[i].reply.img;
							var lis = "";
							if(img != null) {
								//alert(img.length)	
								for(var j = 0; j < img.length; j++) {
									lis += '<li><img src="' + $$$.imgurl + img[j] + ' " style="width: 100%;height: 100%; " /></li>';
								};

							}
							res += '<li class="mui-table-view-cell jok" onclick="gocomdetal(this)" data-id="' + $[i].id + '">';
							res += '<div class="" id="tabbar">';
							res += '	<!--页眉，放置标题-->';
							res += '	<div class="mui-card-header mui-card-media" >';
							res += '		<img style="width: 42px;height:42px;border-radius: 21px; " src="' + $$$.imgurl + $[i].avatar + '" />';
							res += '		<div class="mui-media-body " style="position:reletive;color: #5ca8fc;font-size: 15px;margin-left: 58px; ">';
							res += $[i].uidname;
							res += '			<p style="color: #646464;font-size: 8px;padding-top: 13px; ">' + $[i].addtimen + '</p>';

							// 删除按钮
							res += '<div onclick="goDel(this,event)" style="width:50px;height:50px;color: #5CA8FC;position:absolute;top:10px;right:10px;"><span class="mui-icon mui-icon mui-icon-trash rome" ></span>';

							res += '</div>';

							res += '	</div>';

							res += '	<!--内容区-->';
							res += '	<div class="mui-card-content " style="padding-left: 0px;padding-top:10px; ">';
							res += '		<p style="font-size: 13px;color: #323232; ">' + $[i].content + '</p>';
							res += '		<ul class="smallul">';

							res += lis;
							res += '		</ul>';
							res += '	</div>';
							res += '	<!--页脚，放置补充信息或支持的操作-->';
							res += '	<div class="mui-card-footer ">';
							res += '		<div class="zanping " style="float:right; ">';
							res += '			<img src="images/pinglun.png " style="width: 16px;height: 15px;margin-right: 7px; " />';
							res += '			<span id=" " style="padding-right: 40px; ">' + $[i].replucont + '</span>';
							res += '			<img src="images/dianzan.png " style="width: 16px;height: 15px;margin-right: 7px; " />';
							res += '			<span id=" " style="padding-right: 13px; ">' + $[i].onfabulous + '</span>';
							res += '		</div>';
							res += '	</div>';
							res += '</div>';
							res += '</li>';
						}
					})(this.getData())
					return res;
				},
				insert: function() {

					var ele = document.querySelector('#' + this.id);

					var data = this.creat();

					var div = document.createElement('div');
					div.innerHTML = data;

					if(ele.appendChild) {
						ele.appendChild(div);
					} else {
						ele.append(div);
					}
				},
			}
		</script>
	</body>

</html>