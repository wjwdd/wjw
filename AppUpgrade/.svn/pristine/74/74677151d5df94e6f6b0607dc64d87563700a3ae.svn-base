<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/calendar.css">
		<link rel="stylesheet" href="../../css/iconfont.css">
	</head>
	<style type="text/css">
		/* 整体设置 */
		
		* {
			margin: 0px;
			padding: 0px;
		}
		
		#popover {
			min-width: 282px;
			height: 300px;
			top: 50% !important;
			margin-top: -150px;
			left: 50% !important;
			margin-left: -141px;
		}
		
		@media (min-width: 400px) {
			#popover {
				width: 80%;
				margin-left: -40%;
			}
		}
		
		.mui-popover .mui-popover-arrow {
			display: none !important;
		}
		
		.qdjf {
			padding: 10px 5%;
			font-size: 18px;
			color: #4d5155;
			overflow: hidden;
		}
		
		.qdjf_wz {
			float: left;
			line-height: 25px;
		}
		
		.jfico {
			font-size: 25px;
			color: #39D067;
			float: left;
		}
		
		.zjf {
			color: #39D067;
			padding-left: 10px;
			float: left;
		}
		
		.ljcj {
			float: right;
			font-size: 13px;
			border-radius: 20px;
			border: 1px solid #39D067;
			color: #39D067;
			padding: 0 10px;
			line-height: 20px;
			font-weight: 600;
		}
		
		#jf {
			width: 100%;
			display: block;
			padding: 10px;
			background: #fff;
			box-shadow: -2px 3px 1px #ccc;
			border-radius: 5px;
		}
		
		#jf li {
			padding: 10px;
			margin-bottom: 10px;
			list-style: none;
			border-bottom: 1px solid #ccc;
			overflow: hidden;
			border: 1px solid #ccc;
			border-radius: 5px;
		}
		
		.lq {
			width: 60px;
			text-align: center;
			display: block;
			float: right;
			margin-top: -6px;
			background: #39D067;
			color: #fff;
			border: 0px;
			text-align: center;
			padding: 5px 0;
			border-radius: 20px;
		}
		
		.cmonth {
			width: 45%;
			border: 1px solid #39D067;
			border-radius: 10px;
			padding: 5px;
			float: left;
		}
		
		.omonth {
			width: 45%;
			border: 1px solid #fc6c76;
			border-radius: 10px;
			padding: 5px;
			float: right;
		}
		
		.qdday {
			text-align: center;
			padding: 5px 0;
		}
		
		.daycount {
			font-size: 30px;
			color: #39D067;
		}
		
		.ljdaycou {
			font-size: 30px;
			color: #fc6c76;
		}
	</style>

	<body style="background:#f5f4f4;">

		<header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left wagecolor"></a>
			<h1 class="mui-title">签到</h1>
			<!--<span class="gz" style="display: block;float:right;line-height: 45px;color:#39D067;font-weight: 600;">规则</span>-->
		</header>
		<div class=" mui-scroll-wrapper" style="background: #fff;">
			<div class="mui-scroll">
				<div class="bcwhite">
					<img style="width:100%;margin-top:44px;" src="../../images/everyqd.png" alt="" />

					<p class='calendar' id='calendar' style=""></p>

					<div class="qdjf">
						<span class="mui-icon iconfont icon-jifen jfico"></span>
						<span class="qdjf_wz">当前积分:</span>
						<span class="zjf">10</span>
						<span class="ljcj">立即抽奖</span>
					</div>
				</div>

				<ul id="jf">
					<span class="blable">签到统计</span>
					<div style="overflow: hidden;margin-bottom:10px;">
						<div class="cmonth">
							<p>累计签到天数</p>
							<div class="qdday"><span class="daycount">8</span>天</div>
						</div>
						<div class="omonth">
							<p>当月签到天数</p>
							<div class="qdday"><span class="ljdaycou">8</span>天</div>
						</div>
					</div>

					<span class="blable">每日任务</span>
					<li><span style="display:block;float:left;color:#696c70;">每日登录<span style="color:#ef733c;">&nbsp+&nbsp10&nbsp</span>积分</span><button class="lq">领取</button></li>
					<li><span style="display:block;float:left;color:#696c70;">每日签到<span style="color:#ef733c">&nbsp+&nbsp20&nbsp</span>积分</span><button class="lq">领取</button></li>
					<li><span style="display:block;float:left;color:#696c70;">每日发帖<span style="color:#ef733c">&nbsp+&nbsp20&nbsp</span>积分</span><button class="lq">领取</button></li>
					<li><span style="display:block;float:left;color:#696c70;">每日分享<span style="color:#ef733c">&nbsp+&nbsp30&nbsp</span>积分</span><button class="lq">领取</button></li>

				</ul>
			</div>
		</div>
		<div id="popover" class="mui-popover">
			<div class="mui-popover-arrow"></div>
			<div class="mui-content-padded ">
				<h4 style="color:#22aa12;text-align:center;padding:10px;">请选择职业</h4>
				<div class="fxzw"></div>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/calendar.js"></script>
		<script type='text/javascript'>
			var deceleration = mui.os.ios ? 0.003 : 0.0009;
			mui('.mui-scroll-wrapper').scroll({
				bounce: true,
				indicators: true, //是否显示滚动条
				deceleration: deceleration,
				scrollX: true, //是否横向滚动
			});
			//	qd
			var lq = document.getElementsByClassName('lq');
			var zjf = document.querySelector('.zjf');
			var ljdaycou = document.querySelector('.ljdaycou');
			var nowing = new Date();
			var dayyear = nowing.getFullYear();
			var daymon = nowing.getMonth() + 1;
			if(daymon.toString().length <= 1) {
				daymon = '0' + daymon;
			}
			var str = dayyear + daymon;
			var daycounting = 0;
			console.log(str);
			console.log(zjf.innerHTML);
			mui.ajax($$$.siturl + 'm=App&c=PersonPoint', {
				type: 'get',
				dataType: 'json',
				success: function(data) {
					console.log(JSON.stringify(data));
					zjf.innerHTML = data.data.data.points;
					var ajaxdata = data;

					//创建日历
					calendar(ajaxdata);
					for(var i = 0; i < data.data.tisklog.length; i++) {
						if(data.data.tisklog[i].date.substring(0, 6) == str) {
							daycounting++;
						}
					}
					ljdaycou.innerHTML = daycounting;
					if(data.data.issigngipoind == '1') {
						lq[0].style.background = '#c4c4c4';
						lq[0].innerHTML = '已领取';
					}
					if(data.data.islogipoind == 1) {
						lq[1].style.background = '#c4c4c4';
						lq[1].innerHTML = '已领取';
					}
					if(data.data.isptop == 1) {
						lq[2].style.background = '#c4c4c4';
						lq[2].innerHTML = '已领取';
					}
					if(data.data.isshare == 1) {
						lq[3].style.background = '#c4c4c4';
						lq[3].innerHTML = '已领取';
					}
				}
			})
			var lq = document.getElementsByClassName('lq');
			//每日登录
			lq[0].onclick = function() {
				mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=logpoint', {
					type: 'get',
					dataType: 'json',
					success: function(data) {
						//							console.log(JSON.stringify(data));
						if(data.staus == 1) {
							lq[0].style.background = '#c4c4c4';
							lq[0].innerHTML = '已领取';
							mui.alert(data.msg);
						} else if(data.staus == 2) {
							mui.alert(data.msg);

						} else if(data.staus == 3) {

							mui.alert(data.msg);

						}

					}
				})
			}
			//每日签到
			lq[1].onclick = function() {
				mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=logpoint', {
					type: 'get',
					dataType: 'json',
					success: function(data) {
						console.log(JSON.stringify(data));
						if(data.staus == 1) {
							lq[1].style.background = '#c4c4c4';
							lq[1].innerHTML = '已领取';
							mui.alert(data.msg);
							zjf.innerHTML = parseInt(zjf.innerHTML) + parseInt('20');

						} else if(data.staus == 2) {
							mui.alert(data.msg);

						} else if(data.staus == 3) {

							mui.alert(data.msg);

						}

					}
				})

			}
			//每日发帖
			lq[2].onclick = function() {
				mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=ComTopPoint', {
					type: 'get',
					dataType: 'json',
					success: function(data) {
						//							console.log(JSON.stringify(data));
						if(data.staus == 1) {
							lq[2].style.background = '#c4c4c4';
							lq[2].innerHTML = '已领取';
							mui.alert(data.msg);
							zjf.innerHTML = parseInt(zjf.innerHTML) + parseInt('20');
						} else if(data.staus == 2) {
							mui.alert(data.msg);

						} else if(data.staus == 3) {

							mui.alert(data.msg);

						}

					}
				})
			}
			//每日分享
			var fenxiangurl, fengxianglog, fengxiangtext, fengxiangtop;
			var fxzw = document.querySelector('.fxzw');
			lq[3].onclick = function() {
				mui.ajax($$$.siturl + 'm=App&c=PersonPoint', {
					type: 'get',
					dataType: 'json',
					success: function(data) {
						console.log(JSON.stringify(data));

						if(data.data.isshare == 1) {
							mui.alert('已领取');
							lq[3].style.background = '#c4c4c4';
							lq[3].innerHTML = '已领取';
						} else if(data.data.isshare == 0) {
							var btnArray = ['否', '是'];
							mui.confirm('是否分享', '提示', btnArray, function(e) {
								if(e.index == 1) {
									mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=RandomJob', {
										type: 'get',
										dataType: 'json',
										success: function(data) {
											console.log(JSON.stringify(data));
											fxzw.innerHTML = '';
											for(var i = 0; i < data.data.length; i++) {

												var div = document.createElement('div');
												div.innerHTML += '<div id="xxx" style="font-size:14px;width:100%;height:50px;line-height:50px;">' + data.data[i].jobs_name + '<button class="mui-btn mui-btn-positive mui-btn-outlined mui-pull-right share" data-id="' + data.data[i].jid + '" style="margin:10px 10px 0 0; border: 0;background:#22aa12;color:#fff;border-radius:10px;">分享</button></div>';
												fxzw.appendChild(div);

											}

										}
									})
									setTimeout(function() {
										mui("#popover").popover("toggle");
									}, 300)
								} else {

								}
							})
						}
					}
				})

			}
			//分享
			if(window.plus) {
				onPlusReady();
			} else {
				document.addEventListener('plusready', onPlusReady, false);
			}
			//							var yusr = document.querySelector("#share");
			//							console.log(yusr.outerHTML);

			function onPlusReady() {

				//								yusr.addEventListener("tap", shareHref, false);
				mui(document.body).on('tap', '.share', shareHref);
				updateSerivces();

				//		            document.getElementById('weixin').addEventListener('tap',function() {
				//			            console.log("微信"); 
				//			            authLogin('weixin'); 
				//			        }) 

				if(plus.os.name == "Android") {
					Intent = plus.android.importClass("android.content.Intent");
					File = plus.android.importClass("java.io.File");
					Uri = plus.android.importClass("android.net.Uri");
					main = plus.android.runtimeMainActivity();
				}

				/**分享按钮*/
				function shareHref() {
					console.log(this.getAttribute('data-id'));
					var jid = this.getAttribute('data-id');
					localStorage.setItem('jid', jid);
					mui.ajax($$$.siturl + "m=App&c=index&a=compangprofil&jid=" + jid, {
						type: 'get',
						dataType: 'json',
						success: function(data) {
							console.log(JSON.stringify(data));
							fengxiangtop = "直招帮";
							fengxianglog = $$$.imgurl + 'data/weixin/1.png';
							fengxiangtext = "【直招帮】 " + data.data.jobs_name + "正在招" + data.data.category_cn +
								"综合工资" +
								data.data.minwage +
								"--" +
								data.data.maxwage +
								" 就等你来报名";
							//console.log(fengxiangtext);
							fengxiangtop = fengxiangtext;

						}
					})

					var ids = [{
							id: "weixin",
							ex: "WXSceneSession" /*微信好友*/
						}, {
							id: "weixin",
							ex: "WXSceneTimeline" /*微信朋友圈*/
						}],
						bts = [{
							title: "发送给微信好友"
						}, {
							title: "分享到微信朋友圈"
						}];
					plus.nativeUI.actionSheet({
							cancel: "取消",
							buttons: bts
						},
						function(e) {

							var i = e.index;
							if(i > 0) {
								shareAction(ids[i - 1].id, ids[i - 1].ex);
							}
						}
					);
				}

				/** 
				 * 分享操作 
				 */
				function shareAction(id, ex) {
					var s = null;
					console.log(id, ex);
					if(!id || !(s = shares[id])) {
						outLine("无效的分享服务！");
						return;
					}
					console.log(s.authenticated);
					if(s.authenticated) {
						outSet("---已授权---");
						shareMessage(s, ex);
					} else {
						outSet("---未授权---");
						s.authorize(function() {
							shareMessage(s, ex);
						}, function(e) {
							outLine("认证授权失败");
						});
					}
				}

				/** 
				 * 发送分享消息 
				 */
				function shareMessage(s, ex) {

					var jidjob = localStorage.getItem('jid');
					console.log(ex);
					console.log(JSON.stringify(s));
					var msg = {

						href: 'http://www.zhizhaojob.cn/index.php?m=Mobile&c=jobs&a=show&id=' + jidjob,
						title: fengxiangtop,
						content: fengxiangtext,
						thumbs: [fengxianglog],
						pictures: [fengxianglog],
						extra: {
							scene: ex
						}
					};
					s.send(msg, function() {

						//提交
						mui.ajax($$$.siturl + 'm=App&c=PersonPoint&a=SharePoint', {
							type: 'get',
							dataType: 'json',
							success: function(data) {
								console.log(JSON.stringify(data));
								mui.alert(data.msg);
								if(data.staus == 1) {
									zjf.innerHTML = parseInt(zjf.innerHTML) + parseInt('30');
								}
								//									lq[3].style.background = '#c4c4c4';
								//									lq[3].innerHTML = '已领取';

							}
						})
						outLine("分享成功!");

					}, function(e) {
						outLine("分享失败!");
					});
				}

				/** 
				 * 更新分享服务 
				 */
				function updateSerivces() {
					plus.share.getServices(function(s) {
						shares = {};
						for(var i in s) {
							var t = s[i];
							shares[t.id] = t;
						}
						outSet("获取分享服务列表成功");
					}, function(e) {
						outSet("获取分享服务列表失败：" + e.message);
					});
				}

				// 控制台输出日志 
				function outSet(msg) {
					//				            console.log(msg); 
				}
				// 界面弹出吐司提示 
				function outLine(msg) {
					mui.toast(msg);
				}

				// 登录操作 
				function authLogin(type) {
					var s;
					for(var i = 0; i < auths.length; i++) {
						if(auths[i].id == type) {
							s = auths[i];
							break;
						}
					}
					if(!s.authResult) {
						s.login(function(e) {
							mui.toast("登录认证成功！");
							authUserInfo(type);
						}, function(e) {
							mui.toast("登录认证失败！");
						});
					} else {
						mui.toast("已经登录认证！");
					}
				}

				// 微信登录认证信息 
				function authUserInfo(type) {
					var s;
					for(var i = 0; i < auths.length; i++) {
						if(auths[i].id == type) {
							s = auths[i];
							break;
						}
					}
					if(!s.authResult) {
						mui.toast("未授权登录！");
					} else {
						s.getUserInfo(function(e) {
							var josnStr = JSON.stringify(s.userInfo);
							var jsonObj = s.userInfo;
							console.log("获取用户信息成功：" + josnStr);
							showData(type, jsonObj);
							authLogout();
						}, function(e) {
							alert("获取用户信息失败：" + e.message + " - " + e.code);
						});
					}
				}

				function showData(type, data) {
					switch(type) {
						case 'weixin':
							headImage.src = data.headimgurl;
							break;
						case 'qq':
							headImage.src = data.figureurl_qq_2;
							break;
						case 'sinaweibo':
							headImage.src = data.avatar_large;
							break;
						default:
							break;
					}
				}
			}
			mui(document.body).on('tap', '.ljcj', function() {
				mui.openWindow({
					url: '../prize/dazhuanpan.html',
					id: 'dazhuanpan.html',
					createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
					waiting: {
						autoShow: false, //自动显示等待框，默认为true
					}

				})
			})
		</script>
	</body>

</html>