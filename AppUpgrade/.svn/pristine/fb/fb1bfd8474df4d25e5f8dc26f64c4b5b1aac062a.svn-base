<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="../../css/comm.css" rel="stylesheet" />
		<!--标准mui.css-->
		<link rel="stylesheet" href="../../css/mui.min.css">
		<!--App自定义的css-->
		<!--<link rel="stylesheet" type="text/css" href="../css/app.css" />-->
	</head>
	<style type="text/css">
		li {
			list-style: none;
			background-color: #fff;
		}
		
		.shuru {
			border: 1px solid #ccc;
			line-height: 56px;
		}
		
		.shuru input {
			border: none;
			/*outline-style: none;*/
			display: inline-block;
		}
		
		.shuru span {
			display: inline-block;
		}
		
		html,
		body {
			width: 100%;
		}
		
		.section1_hzlc {
			width: 50%;
			padding: 1rem 0 1.5rem 0;
			font-size: 1rem;
			font-weight: 700;
		}
		
		.shuxian {
			width: 0;
			height: 1rem;
			border-left: 4px solid #26aa12;
			float: left;
			padding-right: 1rem;
			margin-left: .5rem;
			margin-top: .1rem;
		}
		
		.mui-clearfix {
			background: #fff;
			border-radius: 10px;
			margin-bottom: .2rem;
			padding: 0 .3rem
		}
		
		.zpimpor {
			display: inline-block;
			color: red;
			position: absolute;
			top: -5px;
		}
		
		.mui-control-content {
			background-color: white;
			min-height: 215px;
		}
		
		.mui-control-content .mui-loading {
			margin-top: 50px;
		}
		
		.mui-segmented-control.mui-segmented-control-inverted~.mui-slider-progress-bar {
			background-color: #26aa12;
		}
		
		.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
			color: #26aa12;
		}
	</style>

	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#26aa12;"></a>
			<h1 class="mui-title">我的工作</h1>
		</header>

		<div class="mui-content">
			<div id="slider" class="mui-slider">
				<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<a class="mui-control-item" href="#item1mobile" style="border-right:1px solid #ccc;">
						我的收藏
					</a>
					<a class="mui-control-item" href="#item2mobile">
						已申请职位
					</a>

				</div>
				<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-6" style="color:#26aa12;"></div>
				<div class="mui-slider-group" id="msgheight">
					<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll scheight">
								<div id="job_list" style="margin-top:-15px;">
								</div>
							</div>
						</div>
					</div>
					<div id="item2mobile" class="mui-slider-item mui-control-content">
						<div id="scroll2" class="mui-scroll-wrapper">
							<div class="mui-scroll scheight">
								<!--<div class="mui-loading">
									<div class="mui-spinner">

									</div>

								</div>-->
								<div id="job_list2" style="margin-top:-15px;">
								</div>
							</div>
						</div>

					</div>

				</div>
			</div>

		</div>
		<script src="../../js/mui.min.js"></script>
		<script>
			mui.init({
				swipeBack: false
			});
			(function($) {
				$('.mui-scroll-wrapper').scroll({
					bounce: true,
					indicators: false //是否显示滚动条
				});
				var sliderSegmentedControl = document.getElementById('sliderSegmentedControl');
				$('.mui-input-group').on('change', 'input', function() {
					if(this.checked) {
						sliderSegmentedControl.className = 'mui-slider-indicator mui-segmented-control mui-segmented-control-inverted mui-segmented-control-' + this.value;
						//force repaint
						sliderProgressBar.setAttribute('style', sliderProgressBar.getAttribute('style'));
					}
				});
				var msgheight = document.querySelector('#msgheight');
				msgheight.style.height = window.screen.availHeight - 80 + 'px';
				var scheight = document.getElementsByClassName('scheight');
				if(scheight) {
					scheight[0].style.minHeight = window.screen.availHeight - 80 + 'px';
					scheight[1].style.minHeight = window.screen.availHeight - 80 + 'px';
					var deceleration = mui.os.ios ? 0.001 : 0.0003;
					
				}
			})(mui);
			//收藏
			mui.ajax($$$.siturl + 'm=App&c=IsLogo&a=favorite', {
				type: 'get',
				dataType: 'json',
				success: function(data) {
					//					 alert(JSON.stringify(data));
					// 职位详细信息
					if(data.staus == 1) {
						var jobs = data.data;
						for(var x = 0; x < jobs.length; x++) {
							new CreateList_index({
								id: 'job_list',
								data: jobs[x]
							})
						}
					}
				},
				error: function(err) {
					//					alert(err);
				}
			});
			//申请
			mui.ajax($$$.siturl + 'm=App&c=IsLogo&a=applyjob', {
				type: 'get',
				dataType: 'json',
				success: function(data) {
					if(data.staus == 1) {
						var jobs = data.data;
						for(var x = 0; x < jobs.length; x++) {
							new CreateList_index({
								id: 'job_list2',
								data: jobs[x]
							})
						}
					}
				},
				error: function(err) {
					//mui.alert(err);
				}
			});

			function CreateList_index(option) {
				this.id = option.id || 'work_detail';
				this.bg = option.bg || '#fff';
				this.data = option.data;
				this.init();
			}
			CreateList_index.prototype = {
				init: function() {
					// 处理id
					var id = this.birthId(this.id);
					// 创建并插入预制组件
					var str = this.create(this.data);
					this.insert(id, str);
				},
				birthId: function(id) {
					var query = '#' + id;
					return query;
				},
				create: function(data) {
					/*定义组件字符串*/
					var tags = data.tag_cn.split(',');
					var leng = 0;
					if(tags.length > 3) {
						leng = 3;

					} else {
						leng = tags.length;
					}
					//alert(3);
					var srce = '';
					for(var i = 0; i < leng; i++) {
						var tageclass = this.tagcolor(tags[i]);
						srce += '<span style="font-size:10px;line-height: 14px;height:14px;box-sizing: border-box;display: inline-block;text-align: center;border-radius: 3px;margin-right:3px;" class="' + tageclass + '" >' + tags[i] + '</span>';
					}
					var result = '';
					// 立即执行函数，只是为了可以点击折叠按钮而已，没有实际功能。里边放置的是result(职位详细信息字符串)
					(function(data) {
						result += '';
						result += '<li  class="mui-table-view-cell " style="box-sizing: border-box;border-bottom:1px solid #CDCDCD; margin:auto" data-id="' + data.jid + '">';
						result += '<div style="padding:0px 0px;margin:0 0 0 0 ;">';
						result += '<div style="width:26%;float:left;padding-right:13px;">';
						result += '<img src="' + $$$.imgurl + data.logo + '" style="width:100%;height:62px;border-radius: 8px;">';
						result += '</div>';
						result += '<div class="" style="float:left;width:74%;">';
						result += '<div class="" style="width:100%">';
						result += '<div  class="">';
						result += '<div class="" style="font-weight:700;font-size:14px;padding-bottom:10px;line-height: 14px;">' + data.jobs_name + '</div>';
						result += '</div>';
						result += '<div  class="" style="position: relative;font-size:12px;padding-bottom: 7px;line-height: 12px;">';
						result += '<div class="" style="color:#737373;">' + data.category_cn + '</div>';
						result += '<div class="wagecolor" style="font-size:1.5em;position:absolute;right:13px;top:0;">' + data.minwage + '-' + data.maxwage + '元</div>';
						result += '</div>';
						result += '<div  class="" style="position:relative;font-size:15px;">';
						result += '<div class="">';
						result += srce;
						result += '</div>';
						result += '<div class="dis" style="position: absolute;right:13px;bottom:0;">' + data.district_cn + '</div>';
						result += '</div>';
						result += '</div>';
						result += '</div>';
						result += '</div>';
						result += '</li>';
						result += ''
					})(data);
					return result;
				},
				insert: function(id, result) {
					var div = document.createElement('div');
					div.innerHTML = result;
					div.addEventListener('click', function() {
						goJobLink(this);
					})
					var box = document.querySelector(id);
					if(box.appendChild) {
						box.appendChild(div);
					} else {
						box.append(div);
					}
				},
				tagcolor: function(y) {
					if(y == '年终奖') return 'tag1';
					else if(y == '工作餐')
						return 'tag2';
					else if(y == '五险一金')
						return 'tag3';
					else if(y == '长白班')
						return 'tag4';
					else if(y == '两班倒')
						return 'tag5';
					else if(y == '双休')
						return 'tag6';
					else if(y == '工作轻松')
						return 'tag3';
					else if(y == '单休')
						return 'tag4';
					else if(y == '恒温车间')
						return 'tag5';
					else if(y == '坐着上班')
						return 'tag5';
					else
						return 'tag7';

				},
			};

			function goJobLink(e) {
				// var jid = localStorage.getItem('jid');
				var li = e.childNodes[0];
				var dataid = li.getAttribute("data-id");
				//alert(dataid);
				//            for(var i in li){
				//            	alert(i);
				//            }
				// var datid= document.getAttribute("data-id");
				//alert(datid);

				var jid = localStorage.setItem('jid', dataid);
				mui.openWindow({
					url: '../job/job.html',
					id: 'job',
					extras: {
						jid: jid
					},
					createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
					waiting: {
						autoShow: true, //自动显示等待框，默认为true
						title: '正在加载...' //等待对话框上显示的提示内容
					}
				})
			}

			//				console.log(msgheight.style.height);
			//			(function($) {
			//				$('.mui-scroll-wrapper').scroll({
			//					indicators: false //是否显示滚动条
			//				});
			//				var html2 = '<ul class="mui-table-view"><img style="width:100%;" src="' + $$$.imgurl + 'data/app/liucheng.png" alt="" /></ul>';
			//
			//				var item2 = document.getElementById('item2mobile');
			//
			//				document.getElementById('slider').addEventListener('slide', function(e) {
			//					if(e.detail.slideNumber === 1) {
			//						if(item2.querySelector('.mui-loading')) {
			//							setTimeout(function() {
			//								item2.querySelector('.mui-scroll').innerHTML = html2;
			//							}, 500);
			//						}
			//					}
			//				});
			//				var sliderSegmentedControl = document.getElementById('sliderSegmentedControl');
			//				$('.mui-input-group').on('change', 'input', function() {
			//					if(this.checked) {
			//						sliderSegmentedControl.className = 'mui-slider-indicator mui-segmented-control mui-segmented-control-inverted mui-segmented-control-' + this.value;
			//						//force repaint
			//						sliderProgressBar.setAttribute('style', sliderProgressBar.getAttribute('style'));
			//					}
			//				});
			//				
			//
			//				//				
			//			})(mui);
		</script>

	</body>

</html>