<!DOCTYPE html>
<html ng-app="commitCtr">

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>

		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/iconfont.css" />

	</head>

	<style type="text/css">
		.fl {
			float: left;
		}
		
		.fr {
			float: right;
			text-align: right;
		}
		
		.clear {
			clear: both;
		}
		
		.mui-table-view:before {
			height: 0!important;
		}
		
		.mui-table-view:after {
			height: 0!important;
		}
		
		.mui-table-view-cell:after {
			height: 0!important;
		}
		
		.text {
			padding-top: 0px!important;
			padding-bottom: 5px!important;
		}
		
		.pic {
			margin-right: 2%;
			float: left;
		}
		/*.comimg {
			width: 70%;
			min-height: 100px;
			max-height: 250px;
			background: url(app/login/images/logo.png) center center no-repeat;
			background-size: 50%;
		}
		
		.comimgs {
			width: 30%;
			height: 100px;
			float:left;
			background: url(app/login/images/logo.png) center center no-repeat;
			background-size: 50%;
		}*/
		
		.shu {
			display: block;
			width: 30px;
			height: 18px;
			text-align: center;
			padding-bottom: 5px;
			font-size: 13px;
			float: left;
		}
		
		.pinglun {
			margin-top: 0;
			list-style-type: none;
		}
		
		.name {
			color: #39D067;
		}
		
		.review {
			color: #333;
		}
		
		.think {
			margin-top: 10px;
			height: 5px;
			background-color: #f5f4f4;
		}
		
		.dianpic {
			/*margin-top: 5px;*/
			display: block;
			float: left;
			background: url(images/images/zan_03.png) center center no-repeat;
			background-size: 100%;
			height: 18px;
			width: 18px;
		}
		
		.dianpic2 {
			display: block;
			float: left;
			background: url(images/dianzan2.png) center center no-repeat;
			background-size: 100%;
			height: 18px;
			width: 18px;
		}
		
		.xiaoxi {
			/*margin-top: 5px;*/
			display: block;
			float: left;
			background: url(images/images/xiaoxi_03.png) center center no-repeat;
			background-size: 100%;
			height: 18px;
			width: 18px;
		}
		
		.mui-preview-image.mui-fullscreen {
			position: fixed;
			z-index: 20;
			background-color: #000;
		}
		
		.mui-preview-header,
		.mui-preview-footer {
			position: absolute;
			width: 100%;
			left: 0;
			z-index: 10;
		}
		
		.mui-preview-header {
			height: 44px;
			top: 50px;
			left: 20px;
		}
		
		.mui-preview-footer {
			height: 50px;
			bottom: 0px;
		}
		
		.mui-preview-header .mui-preview-indicator {
			display: block;
			line-height: 25px;
			color: #fff;
			text-align: center;
			margin: 15px auto 4;
			width: 70px;
			background-color: rgba(0, 0, 0, 0.4);
			border-radius: 12px;
			font-size: 16px;
		}
		
		.mui-preview-image {
			display: none;
			-webkit-animation-duration: 0.5s;
			animation-duration: 0.5s;
			-webkit-animation-fill-mode: both;
			animation-fill-mode: both;
		}
		
		.mui-preview-image.mui-preview-in {
			-webkit-animation-name: fadeIn;
			animation-name: fadeIn;
		}
		
		.mui-preview-image.mui-preview-out {
			background: none;
			-webkit-animation-name: fadeOut;
			animation-name: fadeOut;
		}
		
		.mui-preview-image.mui-preview-out .mui-preview-header,
		.mui-preview-image.mui-preview-out .mui-preview-footer {
			display: none;
		}
		
		.mui-zoom-scroller {
			position: absolute;
			display: -webkit-box;
			display: -webkit-flex;
			display: flex;
			-webkit-box-align: center;
			-webkit-align-items: center;
			align-items: center;
			-webkit-box-pack: center;
			-webkit-justify-content: center;
			justify-content: center;
			left: 0;
			right: 0;
			bottom: 0;
			top: 0;
			width: 100%;
			height: 100%;
			margin: 0;
			-webkit-backface-visibility: hidden;
		}
		
		.mui-zoom {
			-webkit-transform-style: preserve-3d;
			transform-style: preserve-3d;
		}
		
		.mui-slider .mui-slider-group .mui-slider-item img {
			width: auto;
			height: auto;
			max-width: 100%;
			max-height: 100%;
		}
		
		.mui-android-4-1 .mui-slider .mui-slider-group .mui-slider-item img {
			width: 100%;
		}
		
		.mui-android-4-1 .mui-slider.mui-preview-image .mui-slider-group .mui-slider-item {
			display: inline-table;
		}
		
		.mui-android-4-1 .mui-slider.mui-preview-image .mui-zoom-scroller img {
			display: table-cell;
			vertical-align: middle;
		}
		
		.mui-preview-loading {
			position: absolute;
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			display: none;
		}
		
		.mui-preview-loading.mui-active {
			display: block;
		}
		
		.mui-preview-loading .mui-spinner-white {
			position: absolute;
			top: 50%;
			left: 50%;
			margin-left: -25px;
			margin-top: -25px;
			height: 50px;
			width: 50px;
		}
		
		.mui-preview-image img.mui-transitioning {
			-webkit-transition: -webkit-transform 0.5s ease, opacity 0.5s ease;
			transition: transform 0.5s ease, opacity 0.5s ease;
		}
		
		@-webkit-keyframes fadeIn {
			0% {
				opacity: 0;
			}
			100% {
				opacity: 1;
			}
		}
		
		@keyframes fadeIn {
			0% {
				opacity: 0;
			}
			100% {
				opacity: 1;
			}
		}
		
		@-webkit-keyframes fadeOut {
			0% {
				opacity: 1;
			}
			100% {
				opacity: 0;
			}
		}
		
		@keyframes fadeOut {
			0% {
				opacity: 1;
			}
			100% {
				opacity: 0;
			}
		}
		
		p img {
			max-width: 100%;
			height: auto;
		}
		
		.mui-bar~.mui-content .mui-fullscreen {
			top: 44px;
			height: auto;
		}
		
		.mui-pull-top-tips {
			position: absolute;
			top: -20px;
			left: 50%;
			margin-left: -25px;
			width: 40px;
			height: 40px;
			border-radius: 100%;
			z-index: 4
		}
		
		.mui-bar~.mui-pull-top-tips {
			top: 0px;
		}
		
		.mui-pull-top-wrapper {
			width: 42px;
			height: 42px;
			display: block;
			text-align: center;
			background-color: #efeff4;
			border: 1px solid #ddd;
			border-radius: 25px;
			background-clip: padding-box;
			box-shadow: 0 4px 10px #bbb;
			overflow: hidden;
		}
		
		.mui-pull-top-tips.mui-transitioning {
			-webkit-transition-duration: 200ms;
			transition-duration: 200ms;
		}
		
		.mui-pull-top-tips .mui-pull-loading {
			/*-webkit-backface-visibility: hidden;
				-webkit-transition-duration: 400ms;
				transition-duration: 400ms;*/
			margin: 0;
		}
		
		.mui-pull-top-wrapper .mui-icon,
		.mui-pull-top-wrapper .mui-spinner {
			margin-top: 7px;
		}
		
		.mui-pull-top-wrapper .mui-icon.mui-reverse {
			/*-webkit-transform: rotate(180deg) translateZ(0);*/
		}
		
		.mui-pull-bottom-tips {
			text-align: center;
			background-color: #efeff4;
			font-size: 15px;
			line-height: 40px;
			color: #777;
		}
		
		.mui-pull-top-canvas {
			overflow: hidden;
			background-color: #fafafa;
			border-radius: 40px;
			box-shadow: 0 4px 10px #bbb;
			width: 40px;
			height: 40px;
			margin: 0 auto;
		}
		
		.mui-pull-top-canvas canvas {
			width: 40px;
		}
		
		.mui-slider-indicator.mui-segmented-control {
			background-color: #efeff4;
		}
		
		.com_topic {
			display: inline-block;
			line-height: 30px;
			border-radius: 20px;
			font-weight: bold;
			font-size: 16px;
			padding: 3px 0px;
			color: #22aa12;
			margin: 0px 0px 5px;
		}
		
		#header_topic {
			display: inline-block;
			min-width: 100%;
			z-index: 3;
			padding: 10px;
			word-break: keep-all;
			/* 不换行 */
			white-space: nowrap;
			/* 不换行 */
		}
		
		.htopics {
			display: inline-block;
			border-radius: 5px;
			padding: 10px 15px;
			margin-right: 10px;
			background: #fff;
			color: #3F3F3F;
			font-size: 15px;
			font-weight: 800;
		}
		
		.mui-scroll-wrapper1 {
			width: 100%;
			overflow: auto;
			background-image: url(images/15.png);
			background-position: center;
			background-size: 100% 100%;
			background-repeat: no-repeat;
		}
		
		.Post {
			position: fixed;
			bottom: 20px;
			right: 20px;
			width: 50px;
			height: 50px;
			background: #39d167;
			color: #fff;
			text-align: center;
			border-radius: 50%;
			box-shadow: 1px 1px 5px #39d167;
		}
		
		.select {
			border: 1px solid #22aa12;
			color: #fff;
			background: #22aa12;
		}
	</style>

	<body ng-controller="myCtrl">
		<header id="header" class="mui-bar mui-bar-nav" style="background-color: white;">
			<a id="huifushu" style="display: inline-block;position:relative;float:right;">
				<span class="mui-icon iconfont icon-lingdang" style="color:#26aa12;position: relative;">
					<span class="xiaoxicount" style="display: inline-block;width:15px;height:15px;border-radius: 50%;background:#ff0000;position: absolute;top:8px;right:8px;color:#fff;font-size: 10px;text-align: center;line-height: 15px;" ng-bind="xiaoxicount">1</span>
				</span>
			</a>
			<h1 class="mui-title">社区</h1>
			<!--			<sapn class="fr" id="tiaozhuan"><span class="mui-icon iconfont icon-qianbi2" style="color:#26aa12;"></span></sapn>-->

		</header>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll" style="padding-top:0px;">
				<div class="mui-scroll-wrapper1">
					<div id="header_topic" class="mui-scroll1">
						<span class="htopics">
							<span class="bunlogo mui-icon iconfont icon-qunshezhi" style="background: #39d167;"></span> #热门推荐#
						</span>
						<span class="htopics">
							<span class="bunlogo mui-icon iconfont icon-meishi" style="background: #ffd943;"></span> #生活八卦#
						</span>
						<span class="htopics">
							<span class="bunlogo mui-icon iconfont icon-youji" style="background: #ffb667;"></span> #打工生活#
						</span>

					</div>
				</div>
				<ul class="mui-table-view touxiang" style="z-index: 2;background: #F0F3F8;">
					<li ng-repeat="x in shuju" ng-click="chuanid(this)" style="margin-bottom:5px;background: #fff;">
						<div style="padding:20px 10px 0px;">
							<img class="mui-media-object mui-pull-left" data-ui-lazyload="{{imgurl+x.logo}}" style="width:40px;height:40px;border-radius: 100%;">
							<div class="mui-media-body" style="position: relative;">
								<span style="font-size: 15px;font-weight: 500;" ng-bind="x.topuserinfo.realname"></span>
								<span ng-if="x.topuserinfo.sex==1" class="mui-icon iconfont icon-nan1" style="color:#5A98E5;font-size:13px;"></span>
								<span ng-if="x.topuserinfo.sex==2" class="mui-icon iconfont icon-nv" style="color:#FE91D6;font-size:18px;"></span>
								<p class='mui-ellipsis' style="font-size: 13px;"><span class="mui-icon iconfont icon-shijianzhongbiao2 wjwhui" style="font-size:13px;"></span><span ng-bind="x.times">今天 10:00</span></p>
								<!--<p class="posi" ng-if="x.city!=null"><span class="mui-icon iconfont icon-yanjing wjwhui" style="font-size:20px;"></span><span class="wjwhui fnt14">123</span></span></p>-->
							</div>
						</div>

						<div class="detail" data-id='{{x.id}}' style="padding:0px 10px;">

							<span style="font-size: 15px;" ng-bind="x.content">有需要在广州找工作的小伙伴吗？男女不限，地点在天河区珠江新城。我司是做信贷的金融公司.</span>
						</div>
						<div class="detail mui-media text" data-id='{{x.id}}'>
							<div ng-repeat="(k,b) in x.img" ng-if="x.img.length==1">
								<div class="mui-content-padded comimg"><img class="pic" style="width:70%;max-height: 250px;" data-preview-src="" data-ui-lazyload={{imgurl+b.img}} /></div>
							</div>
							<div ng-repeat="(k,b) in x.img" ng-if="x.img.length>1">
								<div class="mui-content-padded comimgs"><img class="pic" style="width:30%;height: 100px;" data-preview-src="" data-ui-lazyload={{imgurl+b.img}} /></div>
							</div>

						</div>
						<div style="width:100%;">
							<div style="padding: 10px;">

								<span class="mui-icon iconfont icon-shape2 wjwhui "></span><span class="wjwhui" style="font-size:12px;" ng-bind="x.city+x.district">青岛 黄岛区</span>
								<div class="fr" style="margin-right: 3%;">
									<span ng-class="dzclassname(x.className)" data-dzid="{{x.id}}" style="font-size:20px;">
											<span class="wjwhui fnt14 " ng-bind="x.famouscount">123</span>
									<div class="jiayi">+1</div>
									</span>
									<span class="mui-icon iconfont icon-pinglun wjwhui detail" data-id='{{x.id}}'></span><span class="wjwhui fnt14" ng-bind="x.replaycount">123</span></span>
								</div>
							</div>
							<div class="detail" data-id='{{x.id}}' style="padding:0 10px 10px;">
								<div ng-if="results.length != 0" class="entry-trangle-top">
								</div>
								<ul class="pinglun" ng-repeat="a in x.replay | filter:q as results" style="border: 2px solid #f6f6f6; border-radius: 6px;padding-left: 6px;background-color: #f6f6f6;font-size:13px;">
									<li class="name">{{a.uidinfo.realname}}：<span class="review" ng-bind="a.content">来找我聊聊 </span></li>
									<li class="name"><span class="review" ng-model="shuru"></span></li>
									<!--<li class="name">鹤立埠：<span class="review">现在还招人吗</span></li>-->
									<!--<li style="color: #5487fb;" ng-bind="x.replaycountgendduo">查看全部11条评论</li>-->
								</ul>
							</div>
						</div>

					</li>
				</ul>

			</div>

		</div>
		</div>
		<div class="Post" id="tiaozhuan">
			<span class="mui-icon mui-icon-plusempty" style="font-size:50px;"></span>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/ag1.46.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/factory.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/anglazy.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			angular.module('commitCtr', ['myApp', 'lazyload'])
				.controller('myCtrl', function($scope, $http, $data) {
					mui.init({
						swipeBack: false,
						pullRefresh: {
							container: '#pullrefresh',
							down: {
								style: 'circle', //必选，下拉刷新样式，目前支持原生5+ ‘circle’ 样式
								color: '#2BD009', //可选，默认“#2BD009” 下拉刷新控件颜色
								height: '100px', //可选,默认50px.下拉刷新控件的高度,
								range: '150px', //可选 默认100px,控件可下拉拖拽的范围
								offset: '70px', //可选 默认0px,下拉刷新控件的起始位置
								auto: false, //可选,默认false.首次加载自动上拉刷新一次
								callback: pulldownRefresh
							},
							up: {

								contentrefresh: '正在加载...',
								callback: pullupRefresh
							}
						}
					});
					var topicid = '';
					var page;

					function pulldownRefresh() {
						setTimeout(function() {
							page = 1;
							xuanran(page, topicid);
							mui.ajax($$$.siturl + 'm=App&c=DiscuzMsg&a=getXiaoxiCount', {
								type: 'get',

								dataType: 'json',
								success: function(data) {
									if(data.data > 0) {

										xiaoxicount.style.display = "block";
										xiaoxicount.innerHTML = data.data;

									} else {
										xiaoxicount.style.display = "none";

									}

								},
								error: function(xhr, err) {

								}
							});
							mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
						}, 400)
					}

					function pullupRefresh() {
						page++;

						$data.getSheQu(page, topicid).success(function(response) {
							var updata = response.data;

							for(i = 0; i < updata.length; i++) {
								$scope.shuju.push(updata[i]);
							}
							mui('#pullrefresh').pullRefresh().endPullupToRefresh(false);

						});

					}

					window.addEventListener('comrefresh', function(e) {
						location.reload();

					});

					var shequz = document.querySelector('.shequz');
					xuanran(page, topicid);

					function xuanran(page, topicid) {
						$scope.time = "社区";
						$data.getSheQu(page, topicid).success(function(response) {
							console.log(JSON.stringify(response));
							$scope.shuju = response.data;
							$scope.imgurl = $$$.imgurl;
							$scope.className = true;
							$scope.dzclassname = function(e) {
								if(e == '1') {
									return 'comdz mui-icon iconfont icon-dianzan2 wjwhui buncolor'
								} else if(e == '0') {
									return 'comdz mui-icon iconfont icon-dianzan2 wjwhui'
								}
							}

						});
					}

					//返回顶部
					document.querySelector('header').addEventListener('tap', function() {
						window.scroll(0, 0);
					});
					//发布评论
					mui(document.body).on('tap', '#tiaozhuan', function() {
						event.stopPropagation();

						mui.ajax($$$.siturl + 'm=App&c=Discuz&a=islogin', {
							type: 'get',
							dataType: 'json',
							success: function(data) {
								if(data.staus == "0") {
									mui.openWindow({
										url: 'app/login/login.html',
										id: 'login'
									})
								} else {
									mui.openWindow({
										url: 'app/community/editTie.html',
										id: 'editTie'
									})
								}
							}

						})

					})

					//回复数
					var xiaoxicount = document.querySelector('#xiaoxicount');
					mui.ajax($$$.siturl + 'm=App&c=DiscuzMsg&a=getXiaoxiCount', {
						type: 'get',
						dataType: 'json',
						success: function(data) {
							if(data.data > 0) {
								//															console.log(JSON.stringify(data.data));
								xiaoxicount.style.display = "inline-block";
								xiaoxicount.innerHTML = data.data;

							} else {
								xiaoxicount.style.display = "none";

							}

						},
						error: function(xhr, err) {

						}
					});

					var xiaoxicount = document.querySelector('.xiaoxicount');
					mui(document.body).on('tap', '#huifushu', function() {
						event.stopPropagation();
						mui.ajax($$$.siturl + 'm=App&c=DiscuzMsg&a=getXiaoxiCount', {
							type: 'get',

							dataType: 'json',
							success: function(data) {
								if(data.data > 0) {

									console.log(JSON.stringify(data.data));
									xiaoxicount.innerHTML = data.data;
									mui.openWindow({
										url: 'app/community/huifume.html',
										id: 'huifume.html'
									})

								} else {
									xiaoxicount.style.display = "none";
									mui.toast('暂无消息！', {
										duration: 'long',
										type: 'div'
									})
								}

							},
							error: function(xhr, err) {

							}
						});

					})
					//社区详情页
					mui(document.body).on('tap', '.detail', function() {
						//	              			
						var tid = this.getAttribute('data-id');
						//			              	console.log(tid);
						localStorage.setItem('t_id', tid);

						mui.openWindow({
							url: 'app/community/community_detail.html',
							id: 'community_detail',
							createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
							waiting: {
								autoShow: false, //自动显示等待框，默认为true
							}
						})
					})

					$data.getSheQuHFcount().success(function(data) {
						//						console.log(JSON.stringify(data));
						$scope.xiaoxicount = data.data;

					}).error(function(e) {
						//							console.log(e);
					})

					mui(document.body).on('tap', '.comdz', function(e) {
						var id = this.getAttribute('data-dzid');
						var ele = this;

						$data.postSheQuDZ(id).success(function(src) {

							if(src.staus == "0") {
								mui.openWindow({
									id: "login.html",
									url: "login/login.html"
								})
								return;
							}
							if(src.staus == "1") {
								ele.classList.add("buncolor")
								ele.children[0].innerHTML++;
								ele.children[1].style.display = "block";
							}
							if(src.staus == "2") {
								ele.classList.remove("buncolor")
								ele.children[1].style.display = "none";
								ele.children[0].innerHTML = ele.children[0].innerHTML - 1 >= 0 ? ele.children[0].innerHTML - 1 : 0;
							}
						})
					})
					mui(document.body).on('tap', '.htopics', function() {
						mui.toast('暂无新帖');
					})

				})
		</script>

	</body>

</html>