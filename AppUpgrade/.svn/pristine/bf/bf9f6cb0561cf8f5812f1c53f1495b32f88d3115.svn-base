<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style>
			#content .mui-table-view {
				margin-top:0;
				min-height:50px;
				background-color: #EFEFF4;
			}
			#content .mui-table-view .mui-table-view-cell {
				padding:0;
				height:50px;
				background-color: #fff;
			}
			#content .mui-table-view .mui-table-view-cell::after {
				/*使li的底部边线为全屏占满*/
				left:0;
			}
			#content .mui-table-view .mui-table-view-cell input {
				width:80%;
				margin:0;
				padding:0;
				height:50px;
				outline: none;
				border:none;
				
				text-align:right;

				::-webkit-input-placeholder {color: #c7c7c7; direction: rtl; font-size:12px;}
				:-moz-placeholder {color: #c7c7c7; direction: rtl; font-size:12px;}
				::-moz-placeholder {color: #c7c7c7; direction: rtl; font-size:12px;}
				:-ms-input-placeholder {color: #c7c7c7; direction: rtl; font-size:12px;}
			}
			#content input, select, textarea {
				font-size:12px;
			}
			#content .mui-table-view a {
				padding:0;
				margin:0;
				padding-left:8px;
				line-height: 50px;
				font-size:12px;
			}
			#content .mui-table-view .mui-table-view-cell span {
				line-height: 50px;
				font-size:12px;
				padding:0;
				margin:0;
				padding-left:8px;
			}
			
			
			
			/*弹出面板*/
			.mui-popover {
				text-align: center;
				line-height:40px;
			}
			.mui-popover > .mui-table-view-cell {
				border-radius:10px;
			}
			.mui-popover .mui-popover-arrow {
				visibility: hidden;
			}
			.mui-popover .mui-table-view {
				/*border-radius: 5px;*/
			}
			.mui-collapse-content p {
				border-bottom: 1px solid #cdcdcd;
			}
			.mui-table-view-cell.mui-active {
				border-top: 1px solid #cdcdcd;
			}
			
			textarea {
				position: relative;
				width:100%;
				height:100px;
				padding:0;
			}
			
			
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a id="toIndex" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">完善资料</h1>
		</header>
		<div class="mui-content" id="content">
			<ul class="mui-table-view">
				<!--个人头像-->
				<li class="mui-table-view-cell" id="touxiang">
					<a class="mui-navigate-right" style="position:relative;" id="F_CKJLB">
						个人头像 <span style="color:red;">*</span>
						<span class="touxiangchuli" style="position: absolute;right:30px;top:5px;background-image: url(../../images/man.png);background-repeat: no-repeat;background-size: 40px 40px;width:40px;height:40px;display: block;"></span>
					</a>
				</li>
				<!--昵称-->
				<li class="mui-table-view-cell">
					<span>昵称</span><span style="color:red;">*</span>
			    	<input id="name" type="text" class="mui-input-clear" placeholder="请输入您的昵称" value="">
				</li>
				
				
				<!--性别-->
				<li id="sex" class="mui-table-view-cell" style="margin-top:8px;" >
					<span>性别</span><span style="color:red;">*</span>
					<label style="float:right;width:10px;height:50px;line-height: 50px;margin-right:30px;" for="gender2">女 </label>
					<input style="float:right;width:30px;text-align:center;margin-top:14px;height:18px;" name="radio" value="2" id="gender2" type="radio" checked="" >
			    	<label style="float:right;width:20px;height:50px;line-height: 50px;" for="gender1">男</label>
					<input style="float:right;width:30px;margin-top:14px;height:18px;" name="radio" value="1" id="gender1" type="radio" checked=""  >
				</li>
				<!--出生年份-->
				<li class="mui-table-view-cell" >
			    	<a class="mui-navigate-right" href="#years_pop" id="openPopover">
						<span style="padding:0;">出生年份</span><span style="color:red;">*</span>
						<div class="con" style="position: absolute;right:35px;top:0;color:#ADADAD;">请选择</div><!---->
						<input id="years" type="text" class="mui-input-clear" placeholder="请输入您的联系方式" style="padding-right:15px;visibility: hidden;" readonly="readonly">
				 	</a>
				</li>
				
				
				<!--手机号码-->
				<li class="mui-table-view-cell" style="margin-top:8px;" >
					<span>手机号码</span><span style="color:red;">*</span>
			    	<input id="tel" type="text" style="padding-right:20px;width: 70%;float:right" class="mui-input-clear" placeholder="请输入您的联系方式">
				</li>
				
				
				<!--选填信息-->
		        <li class="mui-table-view-cell mui-collapse" style="height:auto;">
		            <a class="mui-navigate-right" href="#">选填信息</a>
		            <div class="mui-collapse-content" style="padding:0;margin:0;">
		                <p style="height:50px;line-height: 50px;font-size:12px;">
							<a class="mui-navigate-right" href="#edu_pop" id="openPopover" style="display: block;position: relative;color:#000;">
								<span style="padding:0;">最高学历</span>
								<span class="con" style="position: absolute;right:35px;top:0;color:#ADADAD;">请选择</span>
								<input id="edu" type="text" class="mui-input-clear" placeholder="请输入您的联系方式" style="padding-right:15px;visibility: hidden;" readonly="readonly">
							</a>
		                </p>
						<p style="height:50px;line-height: 50px;font-size:12px;">
							<a class="mui-navigate-right" href="#exp_pop" id="openPopover" style="display: block;position: relative;color:#000;">
								<span style="padding:0;">工作经验</span>
								<span class="con" style="position: absolute;right:35px;top:0;color:#ADADAD;">请选择</span>
								<input id="exp" type="text" class="mui-input-clear" placeholder="请输入您的联系方式" style="padding-right:15px;visibility: hidden;" readonly="readonly">
							</a>
						</p>
						<p style="height:50px;line-height: 50px;font-size:12px;" id="yixiangzhiwei">
							<a class="mui-navigate-right" href="#jobs_pop" id="openPopover" style="display: block;position: relative;color:#000;">
								<span style="padding:0;">期望职位</span>
								<span class="con" style="position: absolute;right:35px;top:0;color:#ADADAD;">请选择</span>
								<input id="jobs" type="text" class="mui-input-clear" placeholder="请输入您的联系方式" style="padding-right:15px;visibility: hidden;" readonly="readonly">
							</a>
						</p>
						<p style="height:50px;line-height: 50px;font-size:12px;" id="yixiangzhiwei">
							<a class="" style="display: block;position: relative;color:#000;">
								<span style="padding:0;">身份证绑定</span>
								
								<input id="idcard" type="text" class="mui-input-clear" placeholder="可选填" style="padding-right:35px;float:right;width:70%;height:48px;" >
							</a>
						</p>
						<p style="height:50px;line-height: 50px;font-size:12px;" id="yixiangzhiwei">
							<a class="" style="display: block;position: relative;color:#000;">
								<span style="padding:0;">现居住地</span>
							
								<input id="address" type="text" class="mui-input-clear" placeholder="请输入您现在的居住地" style="padding-right:35px;float:right;width:70%;height:48px;" >
							</a>
						</p>
						<p style="height:150px;line-height: 50px;font-size:12px;" id="yixiangzhiwei">
							<a class="" style="display: block;position: relative;color:#000;">
								<span style="padding:0;">个性签名</span> 
								<textarea id="desc" name="desc" rows="" cols="" style="outline: none;border: none;;">
									
								</textarea>
								<span id="text_mask" style="width:100%;height:100px;position: absolute;top:50px;left:0;color:#adadad;">
											简单介绍一下自己吧										
								</span>
							</a>
						</p>
		            </div>
		        </li>
				
				<button id="submit" style="margin:70px 1.5%;background-color: #5CA8FC;width:97%;color:#fff;border-bottom: none;border:none;margin-bottom: 100px;">提交</button>
				
				
				
				<!--弹出框-->
				<!--出生日期-->
				<div id="years_pop" class="mui-popover" style="height:300px;">
				    <div class="mui-scroll-wrapper">
				        <div class="mui-scroll">
				            <ul class="mui-table-view">
				                <li class="mui-table-view-cell"><a href="#">请选择</a></li>

				            </ul>
				        </div>
				    </div>
				</div>
				<!--最高学历-->
				<div id="edu_pop" class="mui-popover" style="height:250px;">
					<div class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul class="mui-table-view">
								<li class="mui-table-view-cell"><a href="#">请选择</a></li>
								<li class="mui-table-view-cell"><a href="#">硕士</a></li>
								<li class="mui-table-view-cell"><a href="#">本科</a></li>
								<li class="mui-table-view-cell"><a href="#">高中</a></li>
								<li class="mui-table-view-cell"><a href="#">初中</a></li>
							</ul>
						</div>
					</div>
				</div>
				<!--工作经验-->
				<div id="exp_pop" class="mui-popover" style="height:300px;">
					<div class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul class="mui-table-view">
								<li class="mui-table-view-cell"><a href="#">请选择</a></li>
								<li class="mui-table-view-cell"><a href="#">10年以上</a></li>
								<li class="mui-table-view-cell"><a href="#">5-10年</a></li>
								<li class="mui-table-view-cell"><a href="#">3-5年</a></li>
								<li class="mui-table-view-cell"><a href="#">1-3年</a></li>
								<li class="mui-table-view-cell"><a href="#">1年以下</a></li>
								<li class="mui-table-view-cell"><a href="#">10年以上</a></li>
								<li class="mui-table-view-cell"><a href="#">无经验</a></li>
							</ul>
						</div>
					</div>
				</div>
				<!--期望职位-->
				<div id="jobs_pop" class="mui-popover" style="height:300px;">
					<div class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul class="mui-table-view yixiangzhiwei">
								<li class="mui-table-view-cell"><a href="#">请选择</a></li>
							</ul>
						</div>
					</div>
				</div>
			</ul>
		</div>
		<script src="../../js/mui.min.js"></script>
		<!--函数定义-->
		<script>
			window.addEventListener('backbj', function(e) {  
//			    console.log(1212121);
			    //清空列表内容
			    binguserinfo2();//重新加载要刷新的方法
			});
			// 点击时自动将pop的选中项传给input
            function addTrigger(textId,popId){
                var pop = document.querySelector(popId);
                var ul = pop.querySelector('ul');

                var lis = ul.children;
                var input_hidden = document.querySelector(textId);
                for(var x = 0; x < lis.length; x++){
                    lis[x].onclick = function () {
                        input_hidden.value = this.children[0].innerHTML;
                        var con = input_hidden.parentNode.children[1];
                        con.innerHTML = this.children[0].innerHTML;
                        mui(popId).popover('hide');
                    }
                }
            }
            
		
		</script>
		<script>
			
			mui.plusReady(function(){
				// pop窗可以滚动
				mui('.mui-scroll-wrapper').scroll();
				
				// 动态创建年份
				(function(){
					var ul = document.querySelector('#years_pop ul');
					var date = new Date();
					var max_year = date.getFullYear() - 16;
					var min_year = date.getFullYear() - 65;
					var year_length = max_year - min_year;
					for(var x = 0; x < year_length; x++){
						var li = document.createElement('li');
						li.className = 'mui-table-view-cell';
						var yearNum = max_year - x;
						li.innerHTML = '<a href="#">'+ yearNum +'</a>';
						if(ul.appendChild){
							ul.appendChild(li);
						}else {
							ul.append(li);
						}
					}

                    function addTrigger2(textId,popId){
                        var pop = document.querySelector(popId);
                        var ul = pop.querySelector('ul');

                        var lis = ul.children;
                        var input_hidden = document.querySelector(textId);
                        for(var x = 0; x < lis.length; x++){
                            lis[x].onclick = function () {
                                input_hidden.value = this.children[0].innerHTML;
                                var con = input_hidden.parentNode.children[2];
                                con.innerHTML = this.children[0].innerHTML;
                                mui(popId).popover('hide');
                            }
                        }
                    }
					addTrigger2('#years','#years_pop');
				})();
				// 绑定学历，工作经验的数据
                addTrigger('#edu','#edu_pop');
                addTrigger('#exp','#exp_pop');

				// 动态生成期望职位
				setshuju('.yixiangzhiwei');
				function setshuju(id,option){
					
					mui.ajax($$$.siturl+'m=App&c=Tool&a=squidJoin',{
	                    type:'get',
						data:{
							
						},
						dataType:'json', 
						success:function (str) {
							if(id=='.yixiangzhiwei'){
								insertdata(id,str.category);
								addTrigger('#jobs','#jobs_pop');
							}
							
	                    },
	                   error:function(xhr,type,errorThrown){
							mui.toast('保存失败，稍后再试',{ duration:'short', type:'div' }) ;
						},
					});
				
					
				}
				
				function insertdata(id,category){
					
					var data=datas(id,category);
					var jobs = document.querySelector(id);
					var result='';
					for(var i=0;i<data.length;i++){
					 	//alert(data[i].data);
					 	result+='<li class="mui-table-view-cell"><a href="#">'+data[i].data+'</a></li>';
					}
					jobs.innerHTML=result;
				}
				
				function datas(id,data){
				
				var ar=[];
				if(id=='.yixiangzhiwei'){
					for(d in data){
						var res={};
						res.id=data[d].id;
						res.data=data[d].categoryname;
						ar.push(res);
					}
				}
				
				if(id=='.ulwage'){
					for(d in data){
						var res={};
						res.id=data[d].c_id;
						res.data=data[d].c_name;
						ar.push(res);
					}
				}
				
				if(id=='.diqu'){
					for(d in data){
						var res={};
						res.id=data[d].id;
						res.data=data[d].cnane;
						ar.push(res);
					}
				}
			//alert(JSON.stringify(ar));
				return ar;
			}
			
				
			
			})
		</script>
		<script type="text/javascript">
			mui.init();
			
			// 表单提交开始
			// 获取各行各列的数据
			var username = document.getElementById('name');
			var radios = document.querySelectorAll('#sex input');
			var year = document.querySelector('#years');
			var phone = document.querySelector('#tel');
			var edu = document.querySelector('#edu');
			var exp = document.querySelector('#exp');
			var job = document.querySelector('#jobs');
			var idcard = document.querySelector('#idcard');
			var address = document.querySelector('#address');
			var desc = document.querySelector('#desc');
			var idert='';


            // 多行文本点击时，灰色字体消失,光标聚焦
            var text_mask = document.querySelector('#text_mask');
            text_mask.onclick = function () {
                this.style.display = 'none';
                desc.focus();
            };
						
			var gender = "";
            
					
			submit.addEventListener('click',function(){
                var name_value = username.value;
                var year_value = year.value;
                var phone_value = phone.value;
                var edu_value = edu.value;
                var exp_value = exp.value;
                var job_value = job.value;
                var id_value = idcard.value;
                var address_value = address.value;
                var desc_value = desc.value;
                for(var x = 0; x < radios.length; x++){
					if(radios[x].checked){
					    gender = radios[x].value;
					}
				}
               
                mui.ajax($$$.siturl+'m=App&c=InfoMeber&a=setUserInfo',{
	                    type:'post',
						data:{
							name_value:name_value,
							year_value:year_value,
							phone_value:phone_value,
							gender:gender,
							id:idert,
						},
						dataType:'json', 
						success:function (data) {
							mui.alert('提交成功');
							console.log(data);
							location.href="../../index.html"
	                    },
	                   error:function(xhr,type,errorThrown){
							mui.toast('获取用户信息失败，稍后再试',{ duration:'short', type:'div' }) ;
						},
					})
                
				
//				alert(gender);
//				alert(year_value);
//				alert(phone_value);
//				alert(edu_value);
//				alert(exp_value);
//				alert(job_value);
//				alert(id_value);
//				alert(address_value);
//				alert(desc_value);

			});
			
			binguserinfo();

			function binguserinfo(){
				mui.ajax($$$.siturl+'m=App&c=InfoMeber&a=getuserinfo',{
	                    type:'post',
						data:{
 
						},
						dataType:'json', 
						success:function (data) {
							
							if(data.staus==0){
								mui.toast(data.msg,{ duration:'short', type:'div' }) ;
							}
							if (data.staus==1){
//								console.log(12121);
								//alert(JSON.stringify(data));   
								var avar=document.querySelector('.touxiangchuli');
								//alert(JSON.stringify($$$.imgurl+data.data.avatars)); 
								
								//console.log(data.data.realname);
								
								avar.style.backgroundImage="url("+$$$.imgurl+data.data.avatars+")";
								var name=document.querySelector('#name');
								if(data.data.realname!==undefined)
										name.value=data.data.realname;
								if(data.data.birthday!==undefined)		
										year.value=data.data.birthday;
								var openPopover=document.querySelector('#openPopover');
								if(data.data.birthday!==undefined)	
									openPopover.children[2].innerHTML=data.data.birthday;
								var telephone=document.querySelector('#tel'); 
								if(data.data.phone!==undefined)	
									telephone.value=data.data.phone;
								
								idert=data.data.id;
								
								if(data.data.sex==1){
									radios[1].checked=true;
								}
								
								if(data.data.sex==2){
									radios[0].checked=true;
									//avar.style.backgroundImage="url(../../images/woman.png)";
								}
								
								if(data.data.sex!=1&&data.data.sex!=2){
									radios[0].checked=true;
								}
						
							}
	                    },
	                   error:function(xhr,type,errorThrown){
							mui.toast('获取用户信息失败，稍后再试',{ duration:'short', type:'div' }) ;
						},
					})
			}
			var login_uid = localStorage.getItem('user_name');
			var login_pass = localStorage.getItem('user_pass');
			//更换图片时执行方法
			function binguserinfo2(){
				
				mui.ajax($$$.siturl + 'm=App&c=Mumber&a=logoin',{
					type:'post',
					dataType:'json',
					data:{
						uname:login_uid,
						password:login_pass
					},
					success:function(data){ 
//						console.log(112232323232);
						var avar=document.querySelector('.touxiangchuli');
				
						avar.style.backgroundImage="url("+$$$.imgurl + data.data.avatars+")";
					}
				})
				
				
			}

		</script>
		<script>
document.addEventListener( "plusready",  function(){
			//plus.webview.close('pullrefresh_sub.html');
			var pic=document.querySelector("#F_CKJLB");
			
			pic.addEventListener( "tap",  function(){
				
				
					if (mui.os.plus) {
		                var a = [{ 
		                    title: "拍照" 
		                }, { 
		                    title: "从手机相册选择" 
		                }]; 
		                plus.nativeUI.actionSheet({ 
		                    title: "上传图片", 
		                    cancel: "取消", 
		                    buttons: a 
		                }, function(b) { /*actionSheet 按钮点击事件*/ 
		                    switch (b.index) { 
		                        case 0: 
		                            break; 
		                        case 1: 
		                            getImage(); /*拍照*/ 
		                            break; 
		                        case 2: 
		                            galleryImg();/*打开相册*/ 
		                            break; 
		                        default: 
		                            break; 
		                    } 
		                }) 
		            } 	
			})
			
			function getImage() { 
	            var c = plus.camera.getCamera(); 
	            c.captureImage(function(e) { 
	                plus.io.resolveLocalFileSystemURL(e, function(entry) { 
	                    var s = entry.toLocalURL() + "?version=" + new Date().getTime(); 
	                   localStorage.setItem('tximg',s);
			            
			            mui.openWindow({
							url: 'cropperPic.html',
							id: 'cropperPic.html',
							createNew:false
						})
			            
	                }, function(e) { 
	                    console.log("读取拍照文件错误：" + e.message); 
	                }); 
	            }, function(s) { 
	                console.log("error" + s); 
	            }, { 
	                filename: "_doc/head.png" 
	            }) 
       	 }
			
			    function galleryImg() { 
			            plus.gallery.pick(function(a) { 
			                plus.io.resolveLocalFileSystemURL(a, function(entry) { 
			                    plus.io.resolveLocalFileSystemURL("_doc/", function(root) { 
			                        root.getFile("head.png", {}, function(file) { 
			                            //文件已存在 
			                            file.remove(function() { 
//			                                console.log("file remove success"); 
			                                entry.copyTo(root, 'head.png', function(e) { 
			                                        var e = e.fullPath; 
			                                        //alert(e); 
			                                        localStorage.setItem('tximg',e);
			                                         mui.openWindow({
														url: 'cropperPic.html',
														id: 'cropperPic.html',
														createNew:false
													})
			                                        
			                                       
//			                                        var issaveimg=localStorage.getItem('saveimg');
//			                                        console.log(issaveimg);
													
			                                       /*上传图片*/ 
			                                        //变更大图预览的src 
			                                        //目前仅有一张图片，暂时如此处理，后续需要通过标准组件实现 
			                                    }, 
			                                    function(e) { 
			                                        console.log('copy image fail:' + e.message); 
			                                    }); 
			                            }, function() { 
			                                console.log("delete image fail:" + e.message); 
			                            }); 
			                        }, function() { 
			                            //文件不存在 
			                            entry.copyTo(root, 'head.png', function(e) { 
			                                    var path = e.fullPath; 
			                                    uploadHead(path); /*上传图片*/ 
			                                }, 
			                                function(e) { 
			                                    console.log('copy image fail:' + e.message); 
			                                }); 
			                        }); 
			                    }, function(e) { 
			                        console.log("get _www folder fail"); 
			                    }) 
			                }, function(e) { 
			                    console.log("读取拍照文件错误：" + e.message); 
			                }); 
			            }, function(a) {}, { 
			                filter: "image" 
			            }) 
			        }; 
			        
//	 function getBase64Image(img) { 
//          var canvas = document.createElement("canvas"); 
//          var width = img.width; 
//          var height = img.height; 
//          // calculate the width and height, constraining the proportions 
//          if (width > height) { 
//              if (width > 500) { 
//                  height = Math.round(height *= 500 / width); 
//                  width = 500; 
//              } 
//          } else { 
//              if (height > 500) { 
//                  width = Math.round(width *= 500 / height); 
//                  height = 500; 
//              } 
//          } 
//          canvas.width = width;   /*设置新的图片的宽度*/ 
//          canvas.height = height; /*设置新的图片的长度*/ 
//          var ctx = canvas.getContext("2d"); 
//          ctx.drawImage(img, 0, 0, width, height); /*绘图*/ 
//          var dataURL = canvas.toDataURL("image/png", 1 || 0.8); 
//          return dataURL.replace("data:image/png;base64,", ""); 
//      } 
     
           

			
		},false)
			
			
		</script>
	</body>

</html>