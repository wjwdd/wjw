<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/iconfont.css" rel="stylesheet" />
		<link href="../../css/mui.picker.css" rel="stylesheet" />
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />

		<style>
			body {
				background: #fff;
			}
			
			.mui-content {
				background: #fff;
				padding: 10px;
			}
			
			.mui-input-row {
				border-top: 1px solid #ddd;
				border-bottom: 1px solid #ddd;
				margin: 20px 0;
			}
			
			.mui-input-group .mui-input-row:after {
				position: absolute;
				right: 0;
				bottom: 0;
				left: 15px;
				height: 1px;
				content: '';
				-webkit-transform: scaleY(.5);
				transform: scaleY(.5);
				background-color: #fff;
			}
			
			.mui-input-clear {
				border: 0px;
			}
			
			.tx {
				padding: 2px 0px;
				position: absolute;
				right: 40px;
				top: 0px;
				line-height: 36px;
			}
			
			.tx_wz {
				display: inline-block;
				float: left;
				padding: 0px 10px;
				border-left: 1px solid #ccc;
			}
			
			.tx_img {
				width: 36px;
				height: 36px;
				background: #000;
				border-radius: 50%;
				display: inline-block;
				float: left;
				overflow: hidden;
			}
			
			.tx_img img {
				width: 100%;
			}
			
			.mui-table-view-cell {
				margin-bottom: 20px;
			}
			
			.iconfont {
				font-size: 23px;
				display: inline-block;
				float: left;
				padding-right: 10px;
			}
			
			.linr {
				display: inline-block;
				float: left;
			}
			
			.linr_right {
				max-width: 100px;
				display: inline-block;
				float: right;
				margin-right: 30px;
				font-size: 13px;
				color: #333;
				overflow: hidden;
			}
			
			input[type=text] {
				line-height: 21px;
				width: 100%;
				height: 21px;
				margin-bottom: 5px;
				padding: 0px 15px;
				-webkit-user-select: text;
				border: 0px solid rgba(0, 0, 0, .2);
				border-radius: 3px;
				outline: 0;
				background-color: #fff;
				-webkit-appearance: none;
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#26aa12"></a>

			<h1 class="mui-title">添加简历</h1>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right">
						<span class="mui-icon iconfont icon-touxiang"></span>
						<input class="mui-input-clear cliname" style="width:40%;" type="text" name="" value="" placeholder="昵称" />
					</a>
					<div class="tx">
						<span class="tx_wz">头像</span>
						<span class="tx_img">
							<img src="../../images/weidl.png" alt="" />
						</span>
					</div>
				</li>
				<li class="mui-table-view-cell" id="sex">
					<a class="mui-navigate-right">
						<span class="mui-icon iconfont icon-xingbie"></span>
						<div class="linr">
							选择您的性别
						</div>
						<div class="linr_right sex">
							请选择
						</div>
					</a>
				</li>
				<li class="mui-table-view-cell " id='shengri' data-options='{"type":"date","beginYear":1900,"endYear":2100}'>
					<a class="mui-navigate-right">
						<span class="mui-icon iconfont icon-riliriqi2"></span>
						<div class="linr ">
							选择您的生日
						</div>
						<div class="linr_right birthday">
							请选择
						</div>
					</a>
				</li>
				<li class="mui-table-view-cell" id="daiyu">
					<a class="mui-navigate-right">
						<span class="mui-icon iconfont icon-shenfenzheng"></span>
						<div class="linr ">
							您想找那种工作
						</div>
						<div class="linr_right daiyu">
							请选择
						</div>
					</a>
				</li>
				<li class="mui-table-view-cell xzcity">
					<a class="mui-navigate-right">
						<span class="mui-icon iconfont icon-fujin3"></span>
						<div class="linr ">
							您想在哪工作
						</div>
						<div class="linr_right city">
							请选择
						</div>
					</a>
				</li>
			</ul>
			<button class="submit mui-btn mui-btn-success" style="width:100%">开启工作之旅</button>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.picker.min.js"></script>
		<script src="../../js/mui.poppicker.js"></script>
		<script src="../../js/city.data-3.js"></script>
		<script>
			mui.init();
			var sex = '';
			var birthdate = '';
			var district = '';
			mui('body').on('tap', '.mui-table-view-cell', function() {
				if(this.children[0].children[1].className == 'mui-input-clear cliname') {
					this.children[0].children[1].focus();
				} else {
					document.activeElement.blur();
				}
				//				
			})

			var tx_img = document.querySelector('.tx_img');
			var daiyu = document.querySelector('.daiyu');
			window.addEventListener('fzbackbj', function(e) {
				var resImg = localStorage.getItem('resImg');
				tx_img.children[0].setAttribute('src', resImg);
			});
			window.addEventListener('wantgz', function(e) {
				var wantgz = localStorage.getItem('wantgz');
				daiyu.innerHTML = wantgz;
			});
			//更换头像
			mui('body').on('tap', '.tx', function() {
				event.stopPropagation();
				document.activeElement.blur();
				if(mui.os.plus) {
					var a = [{
						title: "拍照"
					}, {
						title: "从手机相册选择"
					}];
					plus.nativeUI.actionSheet({
						title: "上传图片",
						cancel: "取消",
						buttons: a
					}, function(b) { /*actionSheet 按钮点击事件*/
						switch(b.index) {
							case 0:
								break;
							case 1:
								getImage(); /*拍照*/
								break;
							case 2:
								galleryImg(); /*打开相册*/
								break;
							default:
								break;
						}
					})
				}
			})

			function getImage() {
				var c = plus.camera.getCamera();
				c.captureImage(function(e) {
					var path = plus.io.convertLocalFileSystemURL(e);
					//						console.log(path);
					//压缩
					plus.zip.compressImage({
							src: e,
							dst: path,
							quality: 20,
							overwrite: true
						},
						function(zip) {
							console.log(JSON.stringify(zip));
							localStorage.setItem('tximg', zip.target);

							mui.openWindow({
								url: 'cropperPic.html',
								id: 'cropperPic.html',
								createNew: false
							})
						},
						function(error) {
							alert("Compress error!");
						});

				}, function(s) {
					console.log("error" + s);
				}, {
					filename: "_doc/head.png"
				})
			}

			function galleryImg() {
				plus.gallery.pick(function(e) {

						plus.io.resolveLocalFileSystemURL(e, function(entry) {

							var path = plus.io.convertLocalFileSystemURL(e) + "?version=" + new Date().getTime();

							//								console.log(path);
							//压缩
							plus.zip.compressImage({
									src: e,
									dst: path,
									quality: 20,
									overwrite: true
								},
								function(zip) {

									localStorage.setItem('tximg', zip.target);
									mui.openWindow({
										url: 'cropperPic1.html',
										id: 'cropperPic1.html',
										createNew: false,

									})
								},
								function(error) {
									alert("Compress error!");
								});
						}, function(e) {
							alert("Resolve file URL failed: " + e.message);
						});

					},
					function(e) {
						console.log("取消选择图片");
					}, {
						filter: "image",

					});
			};
			//选择性别
			var sexPicker = new mui.PopPicker();
			sexPicker.setData([{
				text: '男',
				value: '1'
			}, {
				text: '女',
				value: '2'
			}]);
			sexPicker.title('性别');
			var xzcity = document.querySelector('.xzcity');
			var domsex = document.querySelector('.sex');
			mui('body').on('tap', '#sex', function() {
				sexPicker.show(function(items) {
					domsex.innerHTML = items[0].text;
					sex = items[0].value;
					//返回 false 可以阻止选择框的关闭
					//return false;
				});
			})
			//选择生日
			var birthday = document.querySelector('.birthday');

			mui('body').on('tap', '#shengri', function() {

				var _self = this;
				if(_self.picker) {
					_self.picker.show(function(rs) {
						birthday.innerText = rs.text;
						_self.picker.dispose();
						_self.picker = null;
					});
				} else {
					var optionsJson = this.getAttribute('data-options') || '{}';
					var options = JSON.parse(optionsJson);
					var id = this.getAttribute('id');
					/*
					 * 首次显示时实例化组件
					 * 示例为了简洁，将 options 放在了按钮的 dom 上
					 * 也可以直接通过代码声明 optinos 用于实例化 DtPicker
					 */
					_self.picker = new mui.DtPicker(options);
					_self.picker.show(function(rs) {
						/*
						 * rs.value 拼合后的 value
						 * rs.text 拼合后的 text
						 * rs.y 年，可以通过 rs.y.vaue 和 rs.y.text 获取值和文本
						 * rs.m 月，用法同年
						 * rs.d 日，用法同年
						 * rs.h 时，用法同年
						 * rs.i 分（minutes 的第二个字母），用法同年
						 */
						birthday.innerText = rs.text;
						birthdate = rs.text;
						/* 
						 * 返回 false 可以阻止选择框的关闭
						 * return false;
						 */
						/*
						 * 释放组件资源，释放后将将不能再操作组件
						 * 通常情况下，不需要示放组件，new DtPicker(options) 后，可以一直使用。
						 * 当前示例，因为内容较多，如不进行资原释放，在某些设备上会较慢。
						 * 所以每次用完便立即调用 dispose 进行释放，下次用时再创建新实例。
						 */
						_self.picker.dispose();
						_self.picker = null;
					});
				}

			})

			//选择地点
			var _getParam = function(obj, param) {
				return obj[param] || '';
			};
			var cityPicker3 = new mui.PopPicker({
				layer: 3
			});
			cityPicker3.setData(cityData3);
			cityPicker3.title('您想在哪找工作');
			var xzcity = document.querySelector('.xzcity');
			var city = document.querySelector('.city');

			mui('body').on('tap', '.xzcity', function() {
				cityPicker3.show(function(items) {
					city.innerHTML = _getParam(items[0], 'text') + " " + _getParam(items[1], 'text') + " " + _getParam(items[2], 'text');
					district = _getParam(items[0], 'text') + " " + _getParam(items[1], 'text') + " " + _getParam(items[2], 'text');
				});
			})
			//选择待遇
			mui('body').on('tap', '#daiyu', function() {
				mui.plusReady(function() {
					var wc = plus.webview.currentWebview();
					var ws = plus.webview.open('daiyu.html', 'daiyu', {
						right: '10px',
						left: '10px',
						top: '100px',
						bottom: '60px',

					}, 'slide-in-bottom', 200);
					wc.setStyle({
						mask: 'rgba(0,0,0,0.5)',

					});
					// 点击关闭遮罩层
					wc.addEventListener('maskClick', function() {
						wc.setStyle({
							mask: 'none'
						});
						plus.webview.close('daiyu');

					}, false);

				})
			})

			var cliname = document.querySelector('.cliname');
			mui('body').on('tap', '.submit', function() {
				var fullname = cliname.value;
				if(!fullname) {
					alert('请填写昵称');
					return false;
				}
				if(sex == '') {
					alert('请填写性别');
					return;
				}
				if(birthdate == '') {
					alert('请填写生日');
					return;
				}
				if(daiyu.innerHTML == '请选择') {
					alert('请填写地区');
					return;
				}
				if(district == '') {
					alert('请填写地区');
					return;
				}
				var aaaa = localStorage.getItem('wantgz');
				var aaarr = aaaa.split(",");
				//				上传图片
				if(tx_img.children[0].getAttribute('src') != '') {
					var getbase = tx_img.children[0].getAttribute('src').replace("data:image/png;base64,", "");
					mui.ajax($$$.siturl + 'm=App&c=InfoMeber&a=adavarse', {
						data: {
							files: getbase
						},
						dataType: 'json',
						type: 'post',
						timeout: 10000,
						//contentType:2,
						success: function(data) {
							if(data.staus == 1) {
								var list = plus.webview.getWebviewById('wode.html');
								mui.fire(list, 'ymrefresh');

							}
							if(data.staus == 0) {

							}

						},
						error: function(xhr, type, errorThrown) {

						}

					});
				}

				//上传资料
				var data = {
					fullname: fullname,
					sex: sex,
					birthdate: birthdate,
					telephone: localStorage.getItem("telephoneReg"),
					address: district,
					nature: 0
				}

				mui.ajax($$$.siturl + 'm=App&c=IsLogo&a=editorPerfile', {
					type: 'post',
					dataType: 'json',
					data: data,
					success: function(data) {
						console.log(JSON.stringify(data));
						if(data.staus == 1) {
							mui.toast('注册成功');
							//关闭登录注册界面
							var account = localStorage.getItem("telephoneReg");
							var password = localStorage.getItem("psd");

							mui.ajax($$$.siturl + 'm=App&c=Mumber&a=logoin', {
								type: 'post',
								data: {
									uname: account,
									password: password
								},
								success: function(str) {
									var data = JSON.parse(str);
									if(data.staus == "1") {
										recordUserMsg(data);
										var data1 = {
											uid: data.data.uid,
											hope: aaarr,
										}
										mui.ajax('http://www.zhizhaobang.cn/php/index.php?m=App&c=Tool&a=sethope', {
											type: 'post',
											data: data1,
											dataType: 'json',
											success: function(data) {
												console.log(JSON.stringify(data));

											},

											error: function(e) {
												console.log(e);
											}
										})
										var zc = plus.webview.getWebviewById('wode.html');
										mui.fire(zc, 'zhuce');
										var wreg = plus.webview.getWebviewById('reg');
										var wlogin = plus.webview.getWebviewById('login.html');
										wreg.hide('none', 0);
										wlogin.hide('none', 0);
										setTimeout(function() {
											var wde = plus.webview.getWebviewById('fzbianji_delete');
											wde.hide('slide-out-right');
										}, 1000)
										//
									}

								},
								error: function(err) {

								}
							});
						}

						if(data.staus == 0) {
							alert('创建失败，请重试');
						}

					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						//alert(XMLHttpRequest.status);
						//alert(XMLHttpRequest.readyState);
						//alert(textStatus);
					}
				});
			})

			function recordUserMsg(data) {
				localStorage.setItem('user_name', data.data.username);
				localStorage.setItem('user_pass', data.data.pass);
				localStorage.setItem('user_info', JSON.stringify(data.data));
				localStorage.setItem('user_info_sess', JSON.stringify(data.data));
				var timestamp = Date.parse(new Date());

				localStorage.setItem('time', timestamp);

				sessionStorage.setItem('user_info_sess', JSON.stringify(data.data))
				sessionStorage.setItem('isLogin', true);
			}
		</script>
	</body>

</html>