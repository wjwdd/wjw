<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style>
			#content .mui-table-view {
				margin-top: 0;
				min-height: 50px;
				background-color: #EFEFF4;
			}
			
			#content .mui-table-view .mui-table-view-cell {
				padding: 0;
				height: 50px;
				background-color: #fff;
			}
			
			#content .mui-table-view .mui-table-view-cell::after {
				/*使li的底部边线为全屏占满*/
				left: 0;
			}
			
			#content .mui-table-view .mui-table-view-cell input {
				width: 80%;
				margin: 0;
				padding: 0;
				height: 50px;
				outline: none;
				border: none;
				text-align: right;
				::-webkit-input-placeholder {
					color: #c7c7c7;
					direction: rtl;
					font-size: 12px;
				}
				:-moz-placeholder {
					color: #c7c7c7;
					direction: rtl;
					font-size: 12px;
				}
				::-moz-placeholder {
					color: #c7c7c7;
					direction: rtl;
					font-size: 12px;
				}
				:-ms-input-placeholder {
					color: #c7c7c7;
					direction: rtl;
					font-size: 12px;
				}
			}
			
			#content input,
			select,
			textarea {
				font-size: 12px;
			}
			
			#content .mui-table-view a {
				padding: 0;
				margin: 0;
				padding-left: 8px;
				line-height: 50px;
				font-size: 12px;
			}
			
			#content .mui-table-view .mui-table-view-cell span {
				line-height: 50px;
				font-size: 12px;
				padding: 0;
				margin: 0;
				padding-left: 8px;
			}
			/*弹出面板*/
			
			.mui-popover {
				text-align: center;
				line-height: 40px;
			}
			
			.mui-popover>.mui-table-view-cell {
				border-radius: 10px;
			}
			
			.mui-popover .mui-popover-arrow {
				visibility: hidden;
			}
			
			.mui-popover .mui-table-view {
				/*border-radius: 5px;*/
			}
			
			.mui-collapse-content p {
				border-bottom: 1px solid #cdcdcd;
			}
			
			.mui-table-view-cell.mui-active {
				border-top: 1px solid #cdcdcd;
			}
			
			textarea {
				position: relative;
				width: 100%;
				height: 100px;
				padding: 0;
			}
			/*工作地区模态框*/
			
			#areas_intention_pop li {
				height: 30px;
				border-bottom: 1px solid #ccc;
				list-style: none;
			}
			
			.pop-active {
				display: block;
			}
			
			.pop-hidden {
				display: none;
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#26aa12"></a>

			<h1 class="mui-title">添加简历</h1>
		</header>
		<div class="cjs"></div>
		<div class="mui-content" id="content">
			<ul class="mui-table-view">
				<!--个人头像-->
				<!--<li class="mui-table-view-cell" id="touxiang">
					<a class="mui-navigate-right" style="position:relative;">
						个人头像 <span style="color:red;">*</span>
						<span style="position: absolute;right:30px;top:5px;background-image: url(../../images/man.png);background-repeat: no-repeat;background-size: 40px 40px;width:40px;height:40px;display: block;"></span>
						<input type="file">
					</a>
				</li>-->
				<!--昵称-->
				<li class="mui-table-view-cell">
					<span>昵称</span><span style="color:red;">*</span>
					<input id="name" type="text" class="mui-input-clear" placeholder="请输入您的姓名" value="">
				</li>
				<!--性别-->
				<li id="sex" class="mui-table-view-cell" style="margin-top:8px;">
					<span>性别</span><span style="color:red;">*</span>
					<label style="float:right;width:10px;height:50px;line-height: 50px;margin-right:30px;" for="gender2">女 </label>
					<input style="float:right;width:30px;text-align:center;margin-top:14px;height:18px;" name="radio" value="2" id="gender2" type="radio">
					<label style="float:right;width:20px;height:50px;line-height: 50px;" for="gender1">男</label>
					<input style="float:right;width:30px;margin-top:14px;height:18px;" name="radio" value="1" id="gender1" type="radio" checked="checked">
				</li>
				<!--出生年份-->
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" href="#years_pop" id="openPopover">
						<span style="padding:0;">出生年份</span><span style="color:red;">*</span>
						<div class="con" style="position: absolute;right:35px;top:0;color:#ADADAD;">请选择</div>
						<input id="years" type="text" class="mui-input-clear" placeholder="请输入您的联系方式" style="padding-right:15px;visibility: hidden;" readonly="readonly">
					</a>
				</li>
				<!--手机号码-->
				<li class="mui-table-view-cell" style="margin-top:8px;height:50px;line-height:50px;font-size:12px;">
					<a class="" style="display: block;position: relative;color:#000;" ng-controller="myCtrl">
						<span style="padding:0;">手机号码</span>

						<input id="tel" type="text" class="mui-input-clear" ng-model="telephone" placeholder="请输入您现在的联系方式" style="padding-right:35px;float:right;width:70%;height:48px;">
					</a>
				</li>
				<!--所在地区-->
				<li class="mui-table-view-cell" style="height:50px;line-height: 50px;font-size:12px;">
					<a class="" style="display: block;position: relative;color:#000;">
						<span style="padding:0;">现居住地</span>

						<input id="address" type="text" class="mui-input-clear" placeholder="请输入您现在的居住地" style="padding-right:35px;float:right;width:70%;height:48px;">
					</a>
				</li>
				<!--工作地区-->
				<li class="mui-table-view-cell" style="height:50px;line-height: 50px;font-size:12px;">
					<a class="" style="display: block;position: relative;color:#000;">
						<span style="padding:0;">工作地区</span>

						<input id="areas_intention" type="text" class="mui-input-clear" placeholder="请选择意向的工作地区" style="padding-right:35px;float:right;width:70%;height:48px;" readonly>
					</a>
				</li>

				<!--提交按钮-->
				<button id="submit" style="margin:70px 1.5%;background-color: #26AA12;width:97%;color:#fff;border-bottom: none;border:none;margin-bottom: 100px;">提交</button>

				<!--弹出框-->
				<!--出生日期-->
				<div id="years_pop" class="mui-popover" style="height:300px;">
					<div class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<ul class="mui-table-view">
								<li class="mui-table-view-cell">
									<a href="#">请选择</a>
								</li>

							</ul>
						</div>
					</div>
				</div>
				<!--工作地区-->

			</ul>
			<div id="areas_intention_pop" style="z-index:1000;display:none;background-color:#fff;height:200px;width:100%;position: absolute;bottom:0;left:0;">
				<div class="left" style="width:50%;height:100%;display: inline-block;float:left;">
					<ul id="tab" style="padding:0;margin:0;height:50px;line-height: 50px;font-size:12px;text-align: center">
						<li id="tab_1" style="height:100%;">青岛</li>
					</ul>
				</div>

				<div class="mui-scroll-wrapper" style="left:50%;width: 50%;height:100%;display: inline-block;float:right;">
					<div class="mui-scroll">
						<ul id="tab_pop_1" class="mui-table-view" style="line-height: 50px;font-size:12px;text-align: center">
							<li id="" class="mui-table-view-cell">请选择</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<!--函数定义-->
		<script>
			// 点击时自动将pop的选中项传给input
			function addTrigger(textId, popId) {
				var pop = document.querySelector(popId);
				var ul = pop.querySelector('ul');

				var lis = ul.children;
				var input_hidden = document.querySelector(textId);
				for(var x = 0; x < lis.length; x++) {
					lis[x].onclick = function() {
						input_hidden.value = this.children[0].innerHTML;
						var con = input_hidden.parentNode.children[1];
						con.innerHTML = this.children[0].innerHTML;
						mui(popId).popover('hide');
					}
				}
			}
		</script>
		<!--plusready-->
		<script>
			mui.init();
			mui.plusReady(function() {
				// pop窗可以滚动
				mui('.mui-scroll-wrapper').scroll();

				// 动态创建年份
				(function() {
					var ul = document.querySelector('#years_pop ul');
					var date = new Date();
					var max_year = date.getFullYear() - 16;
					var min_year = date.getFullYear() - 65;
					var year_length = max_year - min_year;
					for(var x = 0; x < year_length; x++) {
						var li = document.createElement('li');
						li.className = 'mui-table-view-cell';
						var yearNum = max_year - x;
						li.innerHTML = '<a href="#">' + yearNum + '</a>';
						if(ul.appendChild) {
							ul.appendChild(li);
						} else {
							ul.append(li);
						}
					}

					function addTrigger2(textId, popId) {
						var pop = document.querySelector(popId);
						var ul = pop.querySelector('ul');

						var lis = ul.children;
						var input_hidden = document.querySelector(textId);
						for(var x = 0; x < lis.length; x++) {
							lis[x].onclick = function() {
								input_hidden.value = this.children[0].innerHTML;
								var con = input_hidden.parentNode.children[2];
								con.innerHTML = this.children[0].innerHTML;
								mui(popId).popover('hide');
							}
						}
					}
					addTrigger2('#years', '#years_pop');
				})();
			})
		</script>

		<!--表单提交-->
		<script type="text/javascript">
			// 表单提交开始
			// 获取各行各列的数据

			var username = document.getElementById('name');
			var radios = document.querySelectorAll('#sex input');
			var year = document.querySelector('#years');
			var phone = document.querySelector('#tel');
			var address = document.querySelector('#address');
			var areas_intention_input = document.querySelector('#areas_intention');
			var pvel = localStorage.getItem('telephoneReg');
			phone.value = pvel;
			console.log(pvel);
			var gender = "";
			for(var x = 0; x < radios.length; x++) {
				if(radios[x].checked) {
					gender = radios[x].value;
				}
			}

			function recordUserMsg(data) {
				localStorage.setItem('user_name', data.data.username);
				localStorage.setItem('user_pass', data.data.pass);
				localStorage.setItem('user_info', JSON.stringify(data.data));
				localStorage.setItem('user_info_sess', JSON.stringify(data.data));
				var timestamp = Date.parse(new Date());

				localStorage.setItem('time', timestamp);

				sessionStorage.setItem('user_info_sess', JSON.stringify(data.data))
				sessionStorage.setItem('isLogin', true);
			}
			submit.addEventListener('click', function() {
				var name_value = username.value;
				var year_value = year.value;
				var phone_value = phone.value;
				var address_value = address.value;
				var areas_intention_input_value = sessionStorage.getItem('selectId');

				if(!name_value) {
					alert('请填写昵称');
					return;
				}
				if(!year_value) {
					alert('请选择出生年份');
					return;
				}
				if(!phone_value) {
					alert('请填写手机号');
					return;
				} else {
					var regularMobile = /^13[0-9]{9}$|14[0-9]{9}$|15[0-9]{9}$|18[0-9]{9}$|17[0-9]{9}$/;

					if(!phone_value.match(regularMobile)) {
						alert('手机号码格式有误');
						return;
					}
				}
				if(!address_value) {
					alert('请填写现居住地');
					return;
				}
				if(!areas_intention_input.value) {
					alert('请选择意向工作的地区');
					return;
				}

				mui.ajax($$$.siturl + 'm=App&c=IsLogo&a=editorPerfile', {
					type: 'post',
					dataType: 'json',
					data: {
						fullname: name_value,
						sex: gender,
						birthdate: year_value,
						telephone: phone_value,
						district: '805' + areas_intention_input_value + '0',
						nature: 0
					},
					success: function(data) {

						if(data.staus == 1) {
							mui.toast('注册成功');
							//关闭登录注册界面

							var account = localStorage.getItem("telephoneReg");
							var password = localStorage.getItem("psd");

							mui.ajax($$$.siturl + 'm=App&c=Mumber&a=logoin', {
								type: 'post',
								data: {
									uname: account,
									password: password
								},
								success: function(str) {
									var data = JSON.parse(str);

									if(data.staus == "1") {
										recordUserMsg(data);
										var zc = plus.webview.getWebviewById('wode.html');
										mui.fire(zc, 'zhuce');
										var wreg = plus.webview.getWebviewById('reg');
										var wlogin = plus.webview.getWebviewById('login.html');
										wreg.hide('none', 0);
										wlogin.hide('none', 0);
										setTimeout(function() {
											var wde = plus.webview.getWebviewById('bianji_delete');
											wde.hide('slide-out-right');
										}, 1000)
										//
									}

								},
								error: function(err) {

								}
							});
						}

						if(data.staus == 0) {
							alert('创建失败，请重试');
						}

					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						//alert(XMLHttpRequest.status);
						//alert(XMLHttpRequest.readyState);
						//alert(textStatus);
					}
				});

			});
		</script>

		<!--工作地区动态获取数据-->
		<script>
			var areas_intention_button = document.querySelector('#areas_intention');
			var areas_intention_pop = document.querySelector('#areas_intention_pop');

			// 点击按钮弹出模态框
			areas_intention_button.addEventListener('click', function() {
				// 显示遮罩层，并且第一次ajax数据，获取市级列表
				var mask = mui.createMask(function() {
					areas_intention_pop.style.display = 'none';
				}); //callback为用户点击蒙版时自动执行的回调；
				mask.show(); //显示遮罩
				areas_intention_pop.style['display'] = 'block';

				var bottommask = document.querySelector('.mui-backdrop');

				// 请求数据
				mui.ajax($$$.siturl + 'm=App&c=TagToli&a=districttoall', {
					type: 'get',
					dataType: 'json',
					success: function(data) {

						// 左侧栏目赋值
						var tab = document.querySelector('#areas_intention_pop #tab');
						var tab_1 = tab.children[0];
						tab_1.innerHTML = data.data[0].pnane;
						tab_1.setAttribute('data-id', data.data[0].id);

						// 加载右侧
						var tab_pop_1 = document.querySelector('#areas_intention_pop #tab_pop_1');
						var secData = data.data[0].disdata;

						for(var x = 0; x < secData.length; x++) {
							var li = document.createElement('li');
							li.innerHTML = secData[x].cnane;
							// 设置样式
							li.style.backgroundColor = '#fff';
							li.style.height = '50px';
							li.setAttribute('data-id', secData[x].id);
							tab_pop_1.appendChild(li);

							//绑定点击事件
							li.onclick = function() {

								for(var i = 0; i < secData.length; i++) {
									tab_pop_1.children[i].style.backgroundColor = '#fff';
								}

								// 拿到选中元素的id
								var id = this.getAttribute('data-id');

								// 设置样式
								this.style.backgroundColor = '#5CA8FC';
								//获取数据显示在工作区域
								//
								areas_intention_input.value = this.innerHTML;
								sessionStorage.setItem('selectId', id);

								setTimeout(function() {
									mask.close();
									for(var i = 0; i < secData.length; i++) {
										tab_pop_1.children[i].style.backgroundColor = '#fff';
									}
								}, 200);

							}

						}

					},
					error: function(error) {
						alert(error.msg);
					}
				});

			})
		</script>

	</body>

</html>