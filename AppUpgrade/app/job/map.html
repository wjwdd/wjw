<!DOCTYPE HTML>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.5.0/css/font-awesome.min.css" />
		<link rel="stylesheet" href="../../css/iconfont.css" />
		<title>地图</title>
		<style type="text/css">
			#map {
				width: 100%;
				position: fixed;
				top: 68px;
				bottom: 0px;
				line-height: 200px;
				text-align: center;
				background: #FFFFFF;
			}
			/*头部区域*/
			
			.mui-bar {
				background-color: #5CA8FC;
				height: 10%;
			}
			
			.mui-bar .mui-icon:active {
				opacity: 1;
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav header-top" style="background:#fff;color:#000;">
			<a id="back" href="job.html" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#22aa12"></a>
			<h1 class="mui-title" style="color: #000;">地图</h1>
		</header>
		<div id="map" style="height: 70%;" class="mui-action-back">地图加载中</div>

		<div id="libaiduditu" class="libaiduditu" style="width:100%;height:12%;font-size:12px;padding-top:10px;padding-left:15px;background: #f5f4f4;position: absolute;bottom:10%;border-top:1% solid #dbd9d5;">

		</div>
		<div id="danghang" style="height:10%;width:100%;background:#f5f4f4;position: absolute;bottom:0;text-align:center;line-height:50px;">
			<div style="width:80px;margin:0px auto;">
				<span class="mui-icon iconfont icon-daohang3" style="color:#26aa12;font-size: 30px;padding-top:10px;" ;></span><span style="color:#22aa12;margin-left:0px;font-size:18px;">导航</span>
			</div>
		</div>
	</body>
	<script src="../../js/mui.min.js"></script>
	<script type="text/javascript">
		var address = localStorage.getItem('addresstocompor');
		var x = localStorage.getItem('xmap');
		var y = localStorage.getItem('ymap');
		var em = null,
			map = null;
		var latitude;
		var longitude;
		var latitudeaf;
		var longitudeaf;
		// H5 plus事件处理
		function plusReady() {
			// 确保DOM解析完成
			if(!em || !window.plus || map) {
				return
			};
			map = new plus.maps.Map("map");
			map.centerAndZoom(new plus.maps.Point(x, y), 16);
			var marker = new plus.maps.Marker(new plus.maps.Point(x, y));
			marker.setIcon("images/weizhi.png");
			var bubble = new plus.maps.Bubble(address);
			marker.setBubble(bubble);
			map.addOverlay(marker);
			plus.maps.Map.geocode(address, {}, function(event) {
				var point = event.coord; // 转换后的坐标信息
				var coordType = event.coordType; // 转换后的坐标系类型
				latitudeaf = point.latitude;
				longitudeaf = point.longitude;
			}, function(e) {
				console.log("Failed:" + JSON.stringify(e));
			});
		}
		if(window.plus) {
			plusReady();
		} else {
			document.addEventListener("plusready", plusReady, false);
		}
		// DOMContentloaded事件处理
		document.addEventListener("DOMContentLoaded", function() {
			em = document.getElementById("map");
			if(window.plus) {
			plusReady();
		} else {
			document.addEventListener("plusready", plusReady, false);
		}
		}, false);
		//地图底部导航
		var libaiduditu = document.querySelector('#libaiduditu');
		var address = localStorage.getItem('addresstocompor');
		var comp = localStorage.getItem('comp');
		var company = document.querySelector('#company');
		libaiduditu.innerHTML = '<p style="padding-top:10px;color:#000;font-size:16px;">' + comp + '</p>' + '<p>' + address + '</p>';

		var danghang = document.querySelector('#danghang');
		danghang.addEventListener('click', function() {

			var address = localStorage.getItem('addresstocompor');

			var dst1 = new plus.maps.Point(longitudeaf, latitudeaf);
			var src1 = new plus.maps.Point(longitude, latitude);
			plus.maps.openSysMap(dst1, address, src1);
		})
	</script>

</html>