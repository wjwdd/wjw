<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/mui.picker.min.css" />
		<link rel="stylesheet" href="../../css/iconfont.css" />
		<style type="text/css">
			.shuru {
				border-bottom: 1px solid #b2b2b2;
				line-height: 56px;
			}
			
			.shuru input {
				border: none;
				/*outline-style: none;*/
				display: inline-block;
			}
			
			.shuru span {
				display: inline-block;
			}
			
			html,
			body {
				width: 100%;
			}
			
			.tuijianruzhi {
				width: 100%;
				top: 10px
			}
			
			.mui-control-content {
				/*background-color: white;*/
				min-height: 150px;
			}
		</style>
	</head>

	<body>

		<!--展示推荐入职-->
		<div class="" style="width: 95%;margin: 0px auto 0;border-bottom: 2px solid #e6e6e6;padding: 10px 10px;font-size: 13px;font-size: 12px; font-family: '微软雅黑';background-color: #FFFFFF;">
			<span style="display: inline-block;margin-left: 1%;">排名</span>
			<span style="display: inline-block;margin-left: 23%;">姓名</span>
			<!--<span style="display: inline-block;margin-left: 38%;">推荐人数</span>-->
			<span style="display: inline-block;margin-left: 35%;">奖励金额</span>
		</div>
		<div id="item1mobile" class="mui-slider-item mui-control-content mui-active" style="min-height: 200px;">
			<div id="scroll1" class="mui-scroll-wrapper">
				<div class="mui-scroll" style="padding-top:0px;">
					<ul id="mytuijianruzhi" class="mui-table-view" style="list-style: none;width: 95%;margin: 0 auto;font-size: 12px; font-family: '微软雅黑';background-color: #FFFFFF; margin-left: 2.5%; padding: 0;">
					</ul>
				</div>
			</div>
		</div>
		
		
		<div class="hezi" style="border: 1px solid #b2b2b2;padding: 26px 17px;padding-top:0;margin:15px 13px 13px;background-color: #fff;border-radius: 10px;">
			<div class="name shuru mui-clearfix">
				<span style="float: left;width: 80px;font-size: 16px;color: #22aa12;">好友姓名：</span>
				<span style="float: right;width: 70%;"><input class="picinpt" style="font-size: 16px;margin:0;" font-size: 16px; id="person_phone_name" type="text" placeholder="请填写朋友真实姓名"/></span>
			</div>
			<div class="iphone shuru mui-clearfix">
				<span style="float: left;width: 80px;font-size: 16px;color: #22aa12;">好友电话：</span>

				<span style="float: right;width: 70%;position: relative;">
					<input class="picinpt" style="font-size: 16px;margin:0;" type="tel" placeholder="请填写朋友手机号码" id="person_phone_number" maxlength="11"/>
					<span id="showUserPickerButton" class="mui-icon iconfont icon-dianhuabu" style="position:absolute;top:17px;right:10px;display: inline-block;width: 25px;height: 25px;color:#26AA12;font-size:30px;"></span>
				</span>
			</div>
			<div class="mess" style="text-align: center;color: #22aa12;font-size: 14px; padding-top: 10px; padding-bottom: 10px;">成功推荐好友入职可获得100-300元奖励</div>
			<div class="l-mess" style="font-size: 12px;text-align: left;margin-left:35px;">
				<span style="color: #5CA8FC;"></span>
				<span style=";">①推荐者符合企业要求</span> <br />
				<span>②入职满7-15天后发放奖励</span><br />
				<span>③需登陆状态下推荐好友，方可领取奖励</span>
			</div>
		</div>
		<!--提交按钮-->
		<div class="" style="text-align: center; margin-top: 20px;">
			<button id="submit_info" style="color: white;border-radius:10px;background-color: #22aa12;text-align: center;width: 100px;display:block;margin:0 auto;display: inline-block; padding: 10px 0;">我要推荐</button>
			<div class="" style="width: 40px; display: inline-block;"></div>
			<button id="subcg" style="color: white;border-radius:10px;background-color: #22aa12;text-align: center;width: 100px;display:block;margin:0 auto;display: inline-block;padding: 10px 0;">推荐成功</button>
		</div>
		<!--<div style="margin-top:100px;width:37%;margin:0 auto;">
			<img src="../../images/zhizhao.png" alt="" style="width:100%;height:50px;margin:0 auto;" />
		</div>-->
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.picker.min.js"></script>
		<script src="../../js/mui.poppicker.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: false
			});
			mui.plusReady(function() {
				plus.webview.currentWebview().setStyle({
					softinputMode: "adjustResize" // 弹出软键盘时自动改变webview的高度
				});
			})
			(function($) {
				$('.mui-scroll-wrapper').scroll({
					indicators: true //是否显示滚动条
				});
			})(mui);
			// 准备dom对象
			var showUserPickerButton = document.querySelector('#showUserPickerButton');
			var userPicker = new mui.PopPicker();
			var person_phone_number = document.querySelector('#person_phone_number');
			var person_phone_name = document.querySelector('#person_phone_name');
			var submit_info = document.querySelector('#submit_info');
			var tuijianruzhi = document.querySelector('.tuijianruzhi');
			if(mui.os.ios) {
				mui(document.body).on('tap', '.picinpt', function(event) {
					userPicker.dispose();
				})
				mui(document.body).on('tap', '#showUserPickerButton', function(event) {
					document.activeElement.blur();
					userPicker = new mui.PopPicker();
					var contact_arr = [];
					plus.contacts.getAddressBook(plus.contacts.ADDRESSBOOK_PHONE, function(addressbook) {
						addressbook.find([], function(contacts) {
							for(var i = 0; i < contacts.length; i++) {
								//contact_arr_text是contact_arr数据源中每一个item用于显示的值 此处为联系人名称+手机号
								//这里一定要判断联系人名称不为空 一旦漏判undefined后面所有逻辑都不会执行!!
								if(contacts[i] !== undefined && contacts[i].displayName !== undefined) {
									//判断用户的手机号码不为空时 取手机号码
									if(contacts[i].phoneNumbers[0] !== undefined) {
										var contact_arr_text = contacts[i].displayName + "\t" + contacts[i].phoneNumbers[0].value;
									}
									//若手机号为空 则判断住宅号是否为空 不为空就用住宅号码 若住宅号码也为空 这个用户就不显示了
									else if(contacts[i].phoneNumbers[1] !== undefined) {
										var contact_arr_text = contacts[i].displayName + "\t" + contacts[i].phoneNumbers[1].value;
									}
								}
								//将数据传给数据源
								contact_arr[i] = {
									value: i,
									text: contact_arr_text
								};
							}
							//联系人数据提取关闭加载到选择器中
							userPicker.setData(contact_arr);
							// 获取手机上的通讯录信息
							userPicker.show(function(items) {
								userPicker.dispose();
								var texts = JSON.stringify(items[0]);
								var reg_name = /([\u4e00-\u9fa5]+)/g;
								var reg_number = /([0-9]+\s+[0-9]+\s+[0-9]+)|(1[0-9]+)/g;
								console.log(texts);
								var person_name = texts.match(reg_name);
								var person_number = texts.match(reg_number);
								person_phone_name.value = person_name;
								person_phone_number.value = person_number;
							});

						}, false);
					}, function(e) {
						plus.ui.toast("未能获取到联系人数据!");

					}, function(e) {
						plus.ui.toast("未能获取到手机通讯录!");
					})

				})

			} else if(mui.os.android) {
				//android
				document.addEventListener("plusready", function() {
					showUserPickerButton.addEventListener('tap', function(event) {
						var REQUESTCODE = 1000;
						main = plus.android.runtimeMainActivity();
						var Intent = plus.android.importClass('android.content.Intent');
						var ContactsContract = plus.android.importClass('android.provider.ContactsContract');
						var intent = new Intent(Intent.ACTION_PICK, ContactsContract.Contacts.CONTENT_URI);
						main.onActivityResult = function(requestCode, resultCode, data) {
							if(REQUESTCODE == requestCode) {
								var phoneNumber = null;
								var resultString = "";
								var context = main;
								plus.android.importClass(data);
								var contactData = data.getData();
								var resolver = context.getContentResolver();
								plus.android.importClass(resolver);
								var cursor = resolver.query(contactData, null, null, null, null);
								plus.android.importClass(cursor);
								cursor.moveToFirst();
								var s_ret;
								var s_ret2;
								var givenName = cursor.getString(cursor.getColumnIndex(ContactsContract.Contacts.DISPLAY_NAME));
								s_ret = givenName;
								var contactId = cursor.getString(cursor.getColumnIndex(ContactsContract.Contacts._ID));
								var pCursor = resolver.query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI,
									null, ContactsContract.CommonDataKinds.Phone.CONTACT_ID + " = " + contactId,
									null, null);
								while(pCursor.moveToNext()) {
									phoneNumber = pCursor.getString(pCursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER));
									s_ret2 = phoneNumber;
								}
								person_phone_name.value = s_ret;
								person_phone_number.value = s_ret2;
								cursor.close();
								pCursor.close();
							}
						};
						main.startActivityForResult(intent, REQUESTCODE);
					})

				}, false);
			}

			submit_info.addEventListener('tap', function() {

				var name = person_phone_name.value;
				var numbers = person_phone_number.value;

				if(!name) {
					mui.alert('请输入用户名!');
					return;
				}
				if(!numbers) {
					mui.aalert('请输入手机号');
					return;
				} else {
					var regularMobile = /^13[0-9]{9}$|14[0-9]{9}$|15[0-9]{9}$|18[0-9]{9}$|17[0-9]{9}$/;
					numbers = numbers.replace(/\s+/g, "");
					//alert(numbers);
					if(!numbers.match(regularMobile)) {
						mui.alert('手机号码格式有误');
						return;
					}
				}

				//alert(name);
				//alert(numbers);
				mui.ajax($$$.siturl + 'm=App&c=Tool&a=pullfriend', {
					type: 'post',
					data: {
						name: name,
						tele: numbers
					},
					dataType: 'json',
					success: function(data) {
						mui.alert(data.msg);
						person_phone_name.value = '';
						person_phone_number.value = '';
					},
					error: function(xhr, err) {
						//						mui.alert(xhr);
					}
				});
			})
			fistajax()
			//所有数据
			function fistajax() {
				mui.ajax($$$.siturl + 'm=App&c=Tool&a=toall', {
					type: 'get',
					dataType: 'json',
					success: function(data) {
						//console.log(JSON.stringify(data));
						if(data.staus == 1) {
							bingtufr("#mytuijianruzhi", data.data);
						}
					},
					error: function(xhr, err) {
						//alert(err);
					}
				});
			}

			//自己推荐的
			function mystajax() {
				mui.ajax($$$.siturl + 'm=App&c=Tool&a=getTfriend', {
					type: 'get',
					dataType: 'json',

					success: function(data) {
						console.log(JSON.stringify(data));
						if(data.staus == 1) {
							bingtufr(".mytuijianruzhi", data.data);
						}
						if(data.staus == 0) {
							

						}

					},
					error: function(xhr, err) {
						//alert(err);
					}
				});
			}
			var uyu = ""

			function bingtufr(id, data) {
				

				//原来版本
				var str = ""
				if(data.length !== undefined) {
					for(var i = 0; i < data.length; i++) {
						var b = i + 1;
						str += '<li style="border-bottom: 1px solid #B6B6B6;padding:5px;">'
						str += '<span style="display:inline-block; width: 40px;height:40px; border-radius: 100%; vertical-align: middle; margin-left: 1%;line-height:40px;text-align:center;font-size:20px;">' + b + '</span>'
						str += '<img src="' + $$$.imgurl + data[i].logo + '" style=" width: 40px;height:40px; border-radius: 100%; vertical-align: middle; margin-left: 1%;" />'
						str += '<span style="display: inline-block;margin-left: 5%;width:20%">' + data[i].uname + '</span>'
						str += '<span style="display: inline-block;margin-left: 10%;"></span>'
						str += '<span style="display: inline-block;margin-left: 18%;">' + data[i].money + '</span>'
						str += '</li>'
					}
					document.querySelector(id).innerHTML = str;
				}

			}
			
			//推荐成功
			var subcg = document.getElementById('subcg');
			localStorage.setItem("isTuiFried", '2');
			subcg.addEventListener('click', function() {
				mui.ajax($$$.siturl + 'm=App&c=Tool&a=islogin', {
					type: 'get',
					dataType: 'json',
					success: function(data) {

						//已经登陆
						if(data == "1") {

							mui.openWindow({
								url: "../tuijian/tuifchenggong.html",
								id: 'tuifchenggong'
							})

						}
						if(data == "0") {
							localStorage.setItem("isTuiFried", '1');
							mui.openWindow({
								url: '../login/login.html',
								id: 'login',
							})
							//     shoucang_icon.classList.remove('active');
						}
					},
					error: function(err) {
						//alert(err);
					}
				});

			})
		</script>
	</body>

</html>