<!DOCTYPE html>
<html ng-app="companydetailCtr">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="../../js/mui.min.js"></script>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/jiazaidonghua.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/iconfont.css">
		<style>
			.bb-profile {
				margin-bottom: 6.66px;
			}
			
			.b-profile {
				margin-top: 6.66px;
			}
			
			.profile {
				padding: 0;
				padding-left: 6.66px;
				display: inline-block;
				font-weight: 600;
				color: #626262;
			}
			
			.gonsjianjie {
				text-indent: 2em;
			}
			
			.pro1 {
				width: 16px;
				height: 13px;
			}
			
			.pro2 {
				width: 15px;
				height: 16px;
				//padding-bottom: 0px;
				//padding-top: 3px;
				vertical-align: middle;
			}
			/*正在招聘的公司*/
			
			.comp {
				font-size: 14px;
				color: #323232;
			}
			
			span {}
			
			.opero {
				padding-top: 12px;
				display: inline-block;
				font-size: 12px;
			}
			
			.mui-table-view-cell:after {
				/*left:0;*/
				height: 0;
			}
			
			.gonsjianjie {
				text-indent: 2em;
				/*height : 300px;*/
				/*transition: all 1s;*/
			}
			
			.content-hide {
				height: 220px;
				/*transition: all 1s;*/
			}
			/*tag的颜色*/
		
		.tag1 {
			color: #fe9d9e;
			border: 1px solid #fe9d9e;
		}
		
		.tag2 {
			color: #73cfff;
			border: 1px solid #73cfff;
		}
		
		.tag3 {
			color: #ffa773;
			border: 1px solid #ffa773;
		}
		
		.tag4 {
			color: #5dc3ba;
			border: 1px solid #5dc3ba;
		}
		
		.tag5 {
			color: #cb97f9;
			border: 1px solid #cb97f9;
		}
		
		.tag6 {
			color: #ff84b5;
			border: 1px solid #ff84b5;
		}
		
		.tag7 {
			color: #26aa12;
			border: 1px solid #26aa12;
		}
		</style>
		<script type="text/javascript">
			mui.init();
		</script>
	</head>

	<body ng-controller="myCtrl">

		<header id="header" class="mui-bar mui-bar-nav" style="background: #fff;">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#26AA12;"></a>
			<h1 class="mui-title">企业详情</h1>
			<button class="mui-btn mui-btn-positive mui-btn-outlined mui-pull-right" id="share" style="padding:5px 10px 3px; border: 0;"><span class="mui-icon iconfont icon-fenxiang" style="color:#26aa12";></span></button>
		</header>
		<div class="mui-scroll-wrapper" style="margin-top:45px;">
			<div class="mui-scroll cjs">
				<div class="mui-content">
					<!--轮播图-->
					<div class="mui-slider" style="height:140px;position:relative;text-align:center;overflow: hidden;">
						<!--<p style="margin-top:50px;font-size:40px;">企业图片</p>-->
						<div class="mui-slider">
							<div class="mui-slider-group">
								<div class="mui-slider-item" ng-repeat="x in img">
									<a href="#"><img style="height:140px;width:100%;" ng-src="{{imgurl+x}}" /></a>
								</div>

							</div>
						</div>

					</div>
				</div>

				<ul class="mui-table-view">
					<li class="mui-table-view-cell " style="padding-top: 25px;padding-bottom: 4px;">
						<div class="gongsimigncheng" style="text-align: center;font-weight: 600;color: #777777;" ng-bind="data.companyname">
							青岛兴邦厨具有限公司
						</div>
					</li>

					<li class="mui-table-view-cell" style="padding-top: 4px;padding-bottom: 15px;">

						<div class="mui-collapse-content gongzhng" style="text-align: center;font-size: 16px;color: #A6A6A6">
							<span ng-bind="data.nature_cn"></span> | <span ng-bind="data.district_cn"></span>
						</div>
					</li>

				</ul>
				<ul class="mui-table-view bb-profile" style="margin-bottom: 0px;">

					<li class="mui-table-view-cell b-profile">
						<!--修改公司简介-->
						<img class="pro1" src="image/pro1.png" alt="" />
						<div class="profile " style="font-size: 16px;">
							公司简介
						</div>
					</li>
				</ul>
				<li class="mui-table-view-cell" style="padding-bottom:0;list-style: none;background-color: #fff;;">
					<div class="gonsjianjie" style="z-index: 0;position: relative;font-size:14px;color: #808080" ng-bind='data.contents'>

					</div>
					<div class="show-btn" style="text-align:center;background-color:#fff;padding:0;margin:0;margin-left:-15px;margin-right:-15px;line-height:0x;height:1px;border:1px solid #efefef;position: relative;bottom:0;left:0;font-size: 12px;"></div>
					<!--
                                                                                                                                                                                                                                                           	作者：1311875357@qq.com
                                                                                                                                                                                                                                                           	时间：2017-04-17
                                                                                                                                                                                                                                                           	描述：
                                                                                                                                                                                                                                                           	
                                                                                                                                                                                                                                                           	展开信息
                                                                                                                                                                                                                                                           -->
				</li>

				<!--添加“正在招聘”-->
				<li class="mui-table-view-cell " style="list-style: none;background-color: #fff;margin-top: 3px;">

					<img class="pro2" src="image/pro2.png" alt="" />
					<div class="profile" style="font-size: 16px;">
						该企业正在招聘职位
					</div>
				</li>
				<ul class="mui-table-view uilist">

					<li class="mui-table-view-cell mui-media li_togo_next" ng-click="jobtomp(this)" ng-repeat="x in jobs">

						<div class="mui-media-body" style="">

							<span class="mui-ellipsis" style="color: #8f8f94;color:#000;font-size:15px;font-weight:700;" ng-bind="x.jobs_name"></span><span class="mui-ellipsis mui-pull-right" style="color: #22aa12;">{{x.minwage+'-'+x.maxwage}}</span>

							<p style="margin-top:10px;">
								<span class="mui-ellipsis; " style="display:inline-block;width:20%;color: #737373;" ng-bind="x.category_cn">操作工</span>
								<span>
									
									<span ng-repeat="(xx,yy) in tag[$index]" ng-class="setStyle(yy)"  ng-if='xx<3'  ng-bind='yy' style="font-size:12px;line-height: 12px;height:18px;padding:2px 4px;margin-right:2px;box-sizing: border-box;display: inline-block;text-align: center;border-radius: 5px;margin-right:3px;" ></span>

								</span>
								<span style="color: #000;font-size:13px;" class="mui-ellipsis mui-pull-right" ng-bind="x.district_cn">青岛/黄岛区</span>
							</p>
						</div>

					</li>

				</ul>
				<div class="bt" style="margin:20px 0 20px;padding: 0px 0 20px;text-align: center;">您想要的职位没有找到？
					<a href="../search/search.html" style="color:#26AA12;">立即搜索</a>
				</div>
			</div>
		</div>
	</body>

	<script src="../../js/ag1.46.js"></script>
	<script src="../../js/factory.js"></script>
	<script>
		angular.module('companydetailCtr', ["myApp"])
			.controller('myCtrl', function($scope, $http, $data) {
				var deceleration = mui.os.ios ? 0.003 : 0.0009;
				mui('.mui-scroll-wrapper').scroll({
					bounce: true,
					indicators: true, //是否显示滚动条
					deceleration: deceleration,
					scrollX: true, //是否横向滚动
				});
				var fenxiangurl, fengxianglog, fengxiangtext, fengxiangtop;
				var cid = localStorage.getItem('cid');
				var tagarr = [];
				//				console.log(cid);
				xuanranyemian();

				function xuanranyemian() {
					$data.companydetail(cid).success(function(data) {

						fengxiangtop = "直招帮";
						fengxianglog = $$$.imgurl + 'data/weixin/1.png';
						fengxiangtext = "【直招帮】 " + data.data.companyname + "多个岗位正在招聘，就等你来报名。";
						//console.log(fengxiangtext);
						fengxiangtop = fengxiangtext;
						$scope.img = data.img;
						$scope.jobs = data.jobs;
						$scope.imgleng = data.img.length;
						$scope.data = data.data;
						$scope.imgurl = $$$.imgurl;
						for(var i = 0; i < data.jobs.length; i++) {
							var tags = data.jobs[i].tag_cn.split(',');
							tagarr.push(tags);
						}

						$scope.tag = tagarr;
						$scope.setStyle = function(y) {
								
								if(y == '年终奖') return 'tag1';

								else if(y == '工作餐')
									return 'tag2';
								else if(y == '五险一金')
									return 'tag3';
								else if(y == '长白班')
									return 'tag4';
								else if(y == '两班倒')
									return 'tag5';
								else if(y == '双休')
									return 'tag6';
								else if(y == '工作轻松')
									return 'tag3';
								else if(y == '单休')
									return 'tag4';
								else if(y == '恒温车间')
									return 'tag5';
								else if(y == '坐着上班')
									return 'tag5';
								else
									return 'tag7';

							};

					});
				}
				$scope.jobtomp = function() {
					console.log(this.x.jid);
					localStorage.setItem('jid', this.x.jid);
					mui.openWindow({
						url: '../job/job.html',
						id: 'job.html',
						extras: {

						},
						createNew: true, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
						waiting: {
							autoShow: true, //自动显示等待框，默认为true
							title: '正在加载...', //等待对话框上显示的提示内容
						}
					})
				}
				//fenxiang
				document.addEventListener("plusready", onPlusReady, false);

				var yusr = document.querySelector("#share");

				function onPlusReady() {
					yusr.addEventListener("click", shareHref, false);
					updateSerivces();

					//		            document.getElementById('weixin').addEventListener('tap',function() {
					//			            console.log("微信"); 
					//			            authLogin('weixin'); 
					//			        }) 

					if(plus.os.name == "Android") {
						Intent = plus.android.importClass("android.content.Intent");
						File = plus.android.importClass("java.io.File");
						Uri = plus.android.importClass("android.net.Uri");
						main = plus.android.runtimeMainActivity();
					}

					/**分享按钮*/
					function shareHref() {
						console.log(this);
						var ids = [{
								id: "weixin",
								ex: "WXSceneSession" /*微信好友*/
							}, {
								id: "weixin",
								ex: "WXSceneTimeline" /*微信朋友圈*/
							}],
							bts = [{
								title: "发送给微信好友"
							}, {
								title: "分享到微信朋友圈"
							}];
						plus.nativeUI.actionSheet({
								cancel: "取消",
								buttons: bts
							},
							function(e) {

								var i = e.index;
								if(i > 0) {
									shareAction(ids[i - 1].id, ids[i - 1].ex);
								}
							}
						);
					}

					/** 
					 * 分享操作 
					 */
					function shareAction(id, ex) {
						var s = null;
						console.log(id, ex);
						if(!id || !(s = shares[id])) {
							outLine("无效的分享服务！");
							return;
						}
						console.log(s.authenticated);
						if(s.authenticated) {
							outSet("---已授权---");
							shareMessage(s, ex);
						} else {
							outSet("---未授权---");
							s.authorize(function() {
								shareMessage(s, ex);
							}, function(e) {
								outLine("认证授权失败");
							});
						}
					}

					/** 
					 * 发送分享消息 
					 */
					function shareMessage(s, ex) {

						var cid = localStorage.getItem('cid');
						console.log(cid);
						console.log(ex);
						console.log(JSON.stringify(s));
						var msg = {

							href: 'http://www.zhizhaojob.cn/index.php?m=Mobile&c=Jobs&a=comshow&id=' + cid,
							title: fengxiangtop,
							content: fengxiangtext,
							thumbs: ["http://www.zhizhaojob.cn/data/weixin/1.png"],
							pictures: ["http://www.zhizhaojob.cn/data/weixin/1.png"],
							extra: {
								scene: ex
							}
						};
						s.send(msg, function() {
							outLine("分享成功!");
						}, function(e) {
							outLine("分享失败!");
						});
					}

					/** 
					 * 更新分享服务 
					 */
					function updateSerivces() {
						plus.share.getServices(function(s) {
							shares = {};
							for(var i in s) {
								var t = s[i];
								shares[t.id] = t;
							}
							outSet("获取分享服务列表成功");
						}, function(e) {
							outSet("获取分享服务列表失败：" + e.message);
						});
					}

					// 控制台输出日志 
					function outSet(msg) {
						//				            console.log(msg); 
					}
					// 界面弹出吐司提示 
					function outLine(msg) {
						mui.toast(msg);
					}

					// 登录操作 
					function authLogin(type) {
						var s;
						for(var i = 0; i < auths.length; i++) {
							if(auths[i].id == type) {
								s = auths[i];
								break;
							}
						}
						if(!s.authResult) {
							s.login(function(e) {
								mui.toast("登录认证成功！");
								authUserInfo(type);
							}, function(e) {
								mui.toast("登录认证失败！");
							});
						} else {
							mui.toast("已经登录认证！");
						}
					}

					// 微信登录认证信息 
					function authUserInfo(type) {
						var s;
						for(var i = 0; i < auths.length; i++) {
							if(auths[i].id == type) {
								s = auths[i];
								break;
							}
						}
						if(!s.authResult) {
							mui.toast("未授权登录！");
						} else {
							s.getUserInfo(function(e) {
								var josnStr = JSON.stringify(s.userInfo);
								var jsonObj = s.userInfo;
								console.log("获取用户信息成功：" + josnStr);
								showData(type, jsonObj);
								authLogout();
							}, function(e) {
								alert("获取用户信息失败：" + e.message + " - " + e.code);
							});
						}
					}

					function showData(type, data) {
						switch(type) {
							case 'weixin':
								headImage.src = data.headimgurl;
								break;
							case 'qq':
								headImage.src = data.figureurl_qq_2;
								break;
							case 'sinaweibo':
								headImage.src = data.avatar_large;
								break;
							default:
								break;
						}
					}

				}
			})

		//
	</script>

</html>