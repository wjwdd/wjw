<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
	</head>
	<style>
		.renzheng {
			width: 80%;
			margin-top: 100px;
			background: #26aa12;
			border: 1px solid #26aa12;
			line-height: 30px;
			font-size: 20px;
		}
	</style>

	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#26aa12;"></a>
			<h1 class="mui-title">实名认证</h1>
		</header>
		<div class="mui-content">
			<form class="mui-input-group" action="">
				<div class="mui-input-row">
					<label style="width:100%;font-size:12px;color:red;">请填写真实姓名并与身份证保持一致</label>
				</div>
				<div class="mui-input-row">
					<label for="">姓名：</label>
					<input type="text" class="mui-input-clear customerName" placeholder="请输入姓名">
				</div>
				<div class="mui-input-row">
					<label for="">身份证号：</label>
					<input type="text" class="mui-input-clear cardid" placeholder="请输入身份证号">
				</div>
				<!--<div class="mui-input-row">
					<label for="">手机号：</label>
					<input type="text" class="mui-input-clear tele" placeholder="请输入手机号">
				</div>-->

			</form>

		</div>
		<div style="text-align: center;">
			<button type="button" class="mui-btn mui-btn-success renzheng">认证</button>
		</div>

		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init();

			var userinfo = JSON.parse(localStorage.getItem('user_info'));

			function getDeviceInfo() {
				mui.plusReady(function() {
					plus.geolocation.getCurrentPosition(function(p) {

						var awLatAndLng = '{"lng": "' + p.coords.latitude + '","lat": "' + p.coords.longitude + '"}';
						var i = 0;
						var a;
						var tly1 = [];
						var wid = plus.accelerometer.watchAcceleration(function(o) {

							tly1[i] = '{"type":"' + plus.os.name + '","x":"' + o.xAxis + '","y":"' + o.yAxis + '","z":"' + o.zAxis + '"}';
							i++;
							if(i >= 2) {
								plus.accelerometer.clearWatch(wid);

							}
							if(i == 2) {
								var deviceID = plus.device.uuid; //设备ID

								var deviceIDType = fdevice(); //设备ID类型???
								var deviceModel = plus.device.model; //设备型号
								var diviceType = plus.os.name; //设备类
								var isRoot = "0"; //是否越狱
								var mac = getMac(); //网卡地址
								var systemVersion = plus.os.version; //系统版本号
								function getMac() {
									var mac = "";
									if(plus.os.name == "Android") {
										//WifiManager 
										var Context = plus.android.importClass("android.content.Context");
										var WifiManager = plus.android.importClass("android.net.wifi.WifiManager");
										var wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);
										var WifiInfo = plus.android.importClass("android.net.wifi.WifiInfo");
										var wifiInfo = wifiManager.getConnectionInfo();
										mac = wifiInfo.getBSSID();
									} else {
										mac = '';
									}
									return mac;
								}

								function fdevice() {
									var a = "";
									if(plus.os.name == "Android") {
										a = 'IMEI';
									} else {
										a = 'uuid';
									}
									return a;
								}
								var deviceInfo = '{"awGetGyro":[' + tly1[0] + ',' + tly1[1] + '],"awLatAndLng":' + awLatAndLng + ',"deviceID":"' + deviceID + '","deviceIDType":"' + deviceIDType + '","deviceModel":"' + deviceModel + '","diviceType":"' + diviceType + '","isRoot":"' + isRoot + '","mac":"' + mac + '","systemVersion":"' + systemVersion + '"}';
								//							
								localStorage.setItem('deviceInfo', deviceInfo);
							}
							//						
						}, function(e) {
							alert("Acceleration error: " + e.message);
						});

					}, function(e) {
						alert(e);
					});
				})

			}
			getDeviceInfo();
			mui(document.body).on('tap', '.renzheng', function() {
				mui.plusReady(function() {
					var customerName = document.querySelector('.customerName').value;
					var cardid = document.querySelector('.cardid').value;

					var userinfo = JSON.parse(localStorage.getItem('user_info')); //用户信息
					//				参数
					var accessMode = "";
					var channelNo = "C0000000108";
					var companyName = "直招帮";
					var customerName = customerName;
					var deviceInfo = localStorage.getItem('deviceInfo'); //设备信息

					var md5IdCard = cardid; //身份证号
					var merCode = "1000006"; //商户号
					var merUserId = userinfo.uid; //商户用户ID
					var mobileNo = userinfo.mobile; //手机号
					
					//					接口一登录验证
					mui.ajax($$$.siturl + $$$.suixinjie + 1000001, {
						type: 'post',
						dataType: 'json',
						data: {
							accessMode: accessMode,
							channelNo: channelNo,
							companyName: companyName,
							customerName: customerName,
							deviceInfo: deviceInfo, //陀螺仪
							md5IdCard: md5IdCard, //身份证号
							merCode: merCode, //商户号
							merUserId: merUserId, //商户用户ID
							mobileNo: mobileNo, //手机号

						},
						success: function(data) {
							console.log(JSON.stringify(data));
							if(data.code != '0000') {
								mui.ajax($$$.siturl + $$$.suixinjie + 1000002, {
									type: 'post',
									dataType: 'json',
									data: {
										customerName: customerName,
										md5IdCard: md5IdCard, //身份证号
										merCode: merCode, //商户号
										merUserId: merUserId, //商户用户ID
									},
									success: function(data) {
										console.log(data.code);
										if(data.code == "0000") {
											mui.openWindow({
												url: 'renlianshibie.html',
												id: 'renlianshibie.html',
											})
											localStorage.setItem('customerName', customerName);
											localStorage.setItem('cardid', md5IdCard);
											localStorage.setItem('tele', mobileNo);
										} else {
											alert(JSON.stringify(data.msg));
										}

									},
									error: function(a) {
										console.log(JSON.stringify(a));
									}
								})
							} else if(data.code == '0000') {
								wn = plus.webview.create(data.url, 'test', {
									'titleNView': {
										'backgroundColor': '#fff',
										'titleText': '随薪借',
										'titleColor': '#000',
										autoBackButton: true
									}
								});
								wn.show("slide-in-right");
							}

						},
						error: function(a) {
							console.log(JSON.stringify(a));
						}
					})

				})
			})
		</script>
	</body>

</html>